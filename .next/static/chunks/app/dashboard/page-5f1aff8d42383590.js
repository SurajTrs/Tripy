(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{5935:(e,t,r)=>{Promise.resolve().then(r.bind(r,5399))},5399:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var s=r(5155),a=r(2115),i=r(6046),n=r(8173),l=r.n(n),o=r(7604);function c(){let{user:e,isLoading:t,isAuthenticated:r,logout:n,checkAuth:c}=(0,o.n)(),[d,h]=(0,a.useState)([]),[u,g]=(0,a.useState)("overview"),m=(0,i.useRouter)();(0,a.useEffect)(()=>{(async()=>{console.log("Dashboard: Initial auth state:",{isAuthenticated:r,isLoading:t,user:e});let s=await c();console.log("Dashboard: Auth state after checkAuth:",{isAuthenticated:o.n.getState().isAuthenticated,user:o.n.getState().user,isAuth:s}),s&&x()})()},[c]),(0,a.useEffect)(()=>{console.log("Dashboard: Checking redirect condition:",{isLoading:t,isAuthenticated:r}),t||r||(console.log("Dashboard: Not authenticated, redirecting to login"),m.push("/login"))},[t,r,m]);let x=async()=>{try{let e=await fetch("/api/bookings");if(e.ok){let t=await e.json();h(t)}}catch(e){console.error("Failed to fetch bookings")}},p=async()=>{await n(),m.push("/")};return t?(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-violet-900 via-purple-900 to-indigo-900 flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-white text-xl",children:"Loading..."})}):e?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-violet-900 via-purple-900 to-indigo-900",children:[(0,s.jsx)("header",{className:"bg-white shadow-lg",children:(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between items-center py-6",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Tripy Dashboard"})}),(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsxs)("span",{className:"text-gray-700",children:["Welcome, ",e.firstName,"!"]}),(0,s.jsx)("button",{onClick:p,className:"bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors",children:"Logout"})]})]})})}),(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-lg mb-8",children:[(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsx)("nav",{className:"flex space-x-8 px-6",children:[{id:"overview",name:"Overview",icon:"\uD83D\uDCCA"},{id:"bookings",name:"My Bookings",icon:"✈️"},{id:"profile",name:"Profile",icon:"\uD83D\uDC64"},{id:"plan",name:"Plan New Trip",icon:"\uD83D\uDDFA️"}].map(e=>(0,s.jsxs)("button",{onClick:()=>g(e.id),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat(u===e.id?"border-violet-500 text-violet-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:[(0,s.jsx)("span",{className:"mr-2",children:e.icon}),e.name]},e.id))})}),(0,s.jsxs)("div",{className:"p-6",children:["overview"===u&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 text-white p-6 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total Bookings"}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:d.length})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-green-500 to-teal-600 text-white p-6 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Active Trips"}),(0,s.jsx)("p",{className:"text-3xl font-bold",children:d.filter(e=>"confirmed"===e.status).length})]}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-orange-500 to-red-600 text-white p-6 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Total Spent"}),(0,s.jsxs)("p",{className:"text-3xl font-bold",children:["₹",d.reduce((e,t)=>e+t.totalAmount,0).toLocaleString()]})]})]}),(0,s.jsxs)("div",{className:"bg-gray-50 p-6 rounded-lg",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsx)(l(),{href:"/",className:"bg-white p-4 rounded-lg border border-gray-200 hover:border-violet-300 hover:shadow-md transition-all",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-2xl mr-3",children:"\uD83C\uDFA4"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:"Voice Assistant"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Plan your next trip with AI"})]})]})}),(0,s.jsx)(l(),{href:"/dashboard?tab=bookings",onClick:()=>g("bookings"),className:"bg-white p-4 rounded-lg border border-gray-200 hover:border-violet-300 hover:shadow-md transition-all",children:(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("span",{className:"text-2xl mr-3",children:"\uD83D\uDCCB"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:"View Bookings"}),(0,s.jsx)("p",{className:"text-sm text-gray-600",children:"Check your travel history"})]})]})})]})]})]}),"bookings"===u&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"My Bookings"}),0===d.length?(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("p",{className:"text-gray-500 mb-4",children:"No bookings yet"}),(0,s.jsx)(l(),{href:"/",className:"bg-violet-600 text-white px-6 py-2 rounded-lg hover:bg-violet-700",children:"Plan Your First Trip"})]}):(0,s.jsx)("div",{className:"space-y-4",children:d.map(e=>(0,s.jsx)("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:e.origin&&e.returnTrip?"".concat(e.origin," ↔ ").concat(e.destination):e.destination}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:[new Date(e.departureDate).toLocaleDateString(),e.returnDate&&e.returnTrip&&(0,s.jsxs)(s.Fragment,{children:[" - ",new Date(e.returnDate).toLocaleDateString()]})]}),(0,s.jsxs)("p",{className:"text-sm text-gray-600",children:["Booking ID: ",e.bookingId]})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"font-semibold",children:["₹",e.totalAmount.toLocaleString()]}),(0,s.jsx)("span",{className:"inline-block px-2 py-1 rounded-full text-xs ".concat("confirmed"===e.status?"bg-green-100 text-green-800":"pending"===e.status?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"),children:e.status})]})]})},e.id))})]}),"profile"===u&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Profile Information"}),(0,s.jsx)("div",{className:"bg-gray-50 p-6 rounded-lg",children:(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"First Name"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.firstName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Last Name"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.lastName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.email})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Phone"}),(0,s.jsx)("p",{className:"text-gray-900",children:e.phone})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Member Since"}),(0,s.jsx)("p",{className:"text-gray-900",children:new Date(e.createdAt).toLocaleDateString()})]})]})})]}),"plan"===u&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Plan New Trip"}),(0,s.jsxs)("div",{className:"bg-gradient-to-r from-violet-500 to-purple-600 text-white p-6 rounded-lg",children:[(0,s.jsx)("h4",{className:"text-lg font-semibold mb-2",children:"Ready to travel?"}),(0,s.jsx)("p",{className:"mb-4",children:"Use our AI-powered voice assistant to plan your perfect trip!"}),(0,s.jsx)(l(),{href:"/",className:"bg-white text-violet-600 px-6 py-2 rounded-lg hover:bg-gray-100 transition-colors inline-block",children:"Start Planning"})]})]})]})]})})]}):null}},7604:(e,t,r)=>{"use strict";r.d(t,{n:()=>i});var s=r(9827),a=r(709);let i=(0,s.v)()((0,a.Zr)((e,t)=>({user:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(t,r)=>{try{e({isLoading:!0,error:null}),console.log("AuthStore: Attempting login for:",t);let s=await fetch("/api/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:r}),credentials:"include"}),a=await s.json();if(console.log("AuthStore: Login response:",{status:s.status,data:a}),!s.ok)throw Error(a.message||"Login failed");e({user:a.user,isAuthenticated:!0,isLoading:!1,error:null});try{let t=new Date().getTime(),r=await fetch("/api/auth/me?_=".concat(t),{credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(r.ok){let t=await r.json();console.log("AuthStore: Verified user data after login:",t),e({user:t,isAuthenticated:!0,error:null})}else console.warn("AuthStore: /me endpoint returned non-OK status after login:",r.status)}catch(e){console.error("AuthStore: Failed to verify user after login:",e)}}catch(t){console.error("AuthStore: Login error:",t),e({error:t.message||"An error occurred during login",isLoading:!1,isAuthenticated:!1,user:null})}},signup:async t=>{try{e({isLoading:!0,error:null});let r=await fetch("/api/auth/signup",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"}),s=await r.json();if(!r.ok)throw Error(s.message||"Signup failed");e({user:s.user,isAuthenticated:!0,isLoading:!1,error:null});try{let t=new Date().getTime(),r=await fetch("/api/auth/me?_=".concat(t),{credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(r.ok){let t=await r.json();console.log("AuthStore: Verified user data after signup:",t),e({user:t,isAuthenticated:!0,error:null})}}catch(e){console.error("AuthStore: Failed to verify user after signup:",e)}}catch(t){console.error("AuthStore: Signup error:",t),e({error:t.message||"An error occurred during signup",isLoading:!1,isAuthenticated:!1,user:null})}},logout:async()=>{try{e({isLoading:!0,error:null}),await fetch("/api/auth/logout",{method:"POST",credentials:"include"}),e({user:null,isAuthenticated:!1,isLoading:!1,error:null})}catch(t){console.error("AuthStore: Logout error:",t),e({user:null,isAuthenticated:!1,isLoading:!1,error:t.message||"An error occurred during logout"})}},checkAuth:async()=>{try{t(),e({isLoading:!0,error:null}),console.log("AuthStore: Checking authentication status");let r=new Date().getTime(),s=await fetch("/api/auth/me?_=".concat(r),{credentials:"include",cache:"no-store",headers:{"Cache-Control":"no-cache, no-store, must-revalidate",Pragma:"no-cache",Expires:"0"}});if(console.log("AuthStore: /api/auth/me status:",s.status),!s.ok)return console.log("AuthStore: User not authenticated, status:",s.status),e({user:null,isAuthenticated:!1,isLoading:!1,error:401!==s.status?"Authentication failed":null}),!1;try{let t=await s.json();if(console.log("AuthStore: User authenticated:",t),t&&t.id)return e({user:t,isAuthenticated:!0,isLoading:!1,error:null}),!0;return console.log("AuthStore: Invalid user data received"),e({user:null,isAuthenticated:!1,isLoading:!1,error:null}),!1}catch(t){return console.error("AuthStore: Error parsing JSON response:",t),e({user:null,isAuthenticated:!1,isLoading:!1,error:"Error parsing authentication response"}),!1}}catch(t){return console.error("AuthStore: Error checking auth:",t),e({user:null,isAuthenticated:!1,isLoading:!1,error:t instanceof Error?t.message:"Authentication check failed"}),!1}},clearError:()=>e({error:null})}),{name:"auth-storage",storage:(0,a.KU)(()=>localStorage)}))},709:(e,t,r)=>{"use strict";function s(e,t){let r;try{r=e()}catch(e){return}return{getItem:e=>{var s;let a=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),i=null!=(s=r.getItem(e))?s:null;return i instanceof Promise?i.then(a):a(i)},setItem:(e,s)=>r.setItem(e,JSON.stringify(s,null==t?void 0:t.replacer)),removeItem:e=>r.removeItem(e)}}r.d(t,{KU:()=>s,Zr:()=>i});let a=e=>t=>{try{let r=e(t);if(r instanceof Promise)return r;return{then:e=>a(e)(r),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>a(t)(e)}}},i=(e,t)=>(r,i,n)=>{let l,o={storage:s(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...t},c=!1,d=new Set,h=new Set,u=o.storage;if(!u)return e((...e)=>{console.warn(`[zustand persist middleware] Unable to update item '${o.name}', the given storage is currently unavailable.`),r(...e)},i,n);let g=()=>{let e=o.partialize({...i()});return u.setItem(o.name,{state:e,version:o.version})},m=n.setState;n.setState=(e,t)=>{m(e,t),g()};let x=e((...e)=>{r(...e),g()},i,n);n.getInitialState=()=>x;let p=()=>{var e,t;if(!u)return;c=!1,d.forEach(e=>{var t;return e(null!=(t=i())?t:x)});let s=(null==(t=o.onRehydrateStorage)?void 0:t.call(o,null!=(e=i())?e:x))||void 0;return a(u.getItem.bind(u))(o.name).then(e=>{if(e){if("number"!=typeof e.version||e.version===o.version)return[!1,e.state];if(o.migrate){let t=o.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(e=>{var t;let[s,a]=e;if(r(l=o.merge(a,null!=(t=i())?t:x),!0),s)return g()}).then(()=>{null==s||s(l,void 0),l=i(),c=!0,h.forEach(e=>e(l))}).catch(e=>{null==s||s(void 0,e)})};return n.persist={setOptions:e=>{o={...o,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(o.name)},getOptions:()=>o,rehydrate:()=>p(),hasHydrated:()=>c,onHydrate:e=>(d.add(e),()=>{d.delete(e)}),onFinishHydration:e=>(h.add(e),()=>{h.delete(e)})},o.skipHydration||p(),l||x}},9827:(e,t,r)=>{"use strict";r.d(t,{v:()=>o});var s=r(2115);let a=e=>{let t;let r=new Set,s=(e,s)=>{let a="function"==typeof e?e(t):e;if(!Object.is(a,t)){let e=t;t=(null!=s?s:"object"!=typeof a||null===a)?a:Object.assign({},t,a),r.forEach(r=>r(t,e))}},a=()=>t,i={setState:s,getState:a,getInitialState:()=>n,subscribe:e=>(r.add(e),()=>r.delete(e))},n=t=e(s,a,i);return i},i=e=>e?a(e):a,n=e=>e,l=e=>{let t=i(e),r=e=>(function(e,t=n){let r=s.useSyncExternalStore(e.subscribe,s.useCallback(()=>t(e.getState()),[e,t]),s.useCallback(()=>t(e.getInitialState()),[e,t]));return s.useDebugValue(r),r})(t,e);return Object.assign(r,t),r},o=e=>e?l(e):l}},e=>{var t=t=>e(e.s=t);e.O(0,[28,441,517,358],()=>t(5935)),_N_E=e.O()}]);