"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "vendor-chunks/three-render-objects";
exports.ids = ["vendor-chunks/three-render-objects"];
exports.modules = {

/***/ "(ssr)/./node_modules/three-render-objects/dist/three-render-objects.mjs":
/*!*************************************************************************!*\
  !*** ./node_modules/three-render-objects/dist/three-render-objects.mjs ***!
  \*************************************************************************/
/***/ ((__unused_webpack___webpack_module__, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (/* binding */ threeRenderObjects)\n/* harmony export */ });\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! three */ \"(ssr)/./node_modules/three/build/three.module.js\");\n/* harmony import */ var three__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! three */ \"(ssr)/./node_modules/three/build/three.core.js\");\n/* harmony import */ var three_webgpu__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! three/webgpu */ \"(ssr)/./node_modules/three/build/three.webgpu.js\");\n/* harmony import */ var three_examples_jsm_controls_TrackballControls_js__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! three/examples/jsm/controls/TrackballControls.js */ \"(ssr)/./node_modules/three/examples/jsm/controls/TrackballControls.js\");\n/* harmony import */ var three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_10__ = __webpack_require__(/*! three/examples/jsm/controls/OrbitControls.js */ \"(ssr)/./node_modules/three/examples/jsm/controls/OrbitControls.js\");\n/* harmony import */ var three_examples_jsm_controls_FlyControls_js__WEBPACK_IMPORTED_MODULE_11__ = __webpack_require__(/*! three/examples/jsm/controls/FlyControls.js */ \"(ssr)/./node_modules/three/examples/jsm/controls/FlyControls.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! three/examples/jsm/postprocessing/EffectComposer.js */ \"(ssr)/./node_modules/three/examples/jsm/postprocessing/EffectComposer.js\");\n/* harmony import */ var three_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! three/examples/jsm/postprocessing/RenderPass.js */ \"(ssr)/./node_modules/three/examples/jsm/postprocessing/RenderPass.js\");\n/* harmony import */ var polished__WEBPACK_IMPORTED_MODULE_12__ = __webpack_require__(/*! polished */ \"(ssr)/./node_modules/polished/dist/polished.esm.js\");\n/* harmony import */ var _tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @tweenjs/tween.js */ \"(ssr)/./node_modules/@tweenjs/tween.js/dist/tween.esm.js\");\n/* harmony import */ var accessor_fn__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! accessor-fn */ \"(ssr)/./node_modules/accessor-fn/dist/accessor-fn.mjs\");\n/* harmony import */ var kapsule__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! kapsule */ \"(ssr)/./node_modules/kapsule/dist/kapsule.mjs\");\n/* harmony import */ var float_tooltip__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! float-tooltip */ \"(ssr)/./node_modules/float-tooltip/dist/float-tooltip.mjs\");\n\n\n\n\n\n\n\n\n\n\n\n\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n  if (typeof document === 'undefined') {\n    return;\n  }\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css_248z = \".scene-nav-info {\\n  position: absolute;\\n  bottom: 5px;\\n  width: 100%;\\n  text-align: center;\\n  color: slategrey;\\n  opacity: 0.7;\\n  font-size: 10px;\\n  font-family: sans-serif;\\n  pointer-events: none;\\n  user-select: none;\\n}\\n\\n.scene-container canvas:focus {\\n  outline: none;\\n}\";\nstyleInject(css_248z);\n\nfunction _arrayLikeToArray(r, a) {\n  (null == a || a > r.length) && (a = r.length);\n  for (var e = 0, n = Array(a); e < a; e++) n[e] = r[e];\n  return n;\n}\nfunction _arrayWithHoles(r) {\n  if (Array.isArray(r)) return r;\n}\nfunction _arrayWithoutHoles(r) {\n  if (Array.isArray(r)) return _arrayLikeToArray(r);\n}\nfunction _defineProperty(e, r, t) {\n  return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, {\n    value: t,\n    enumerable: true,\n    configurable: true,\n    writable: true\n  }) : e[r] = t, e;\n}\nfunction _iterableToArray(r) {\n  if (\"undefined\" != typeof Symbol && null != r[Symbol.iterator] || null != r[\"@@iterator\"]) return Array.from(r);\n}\nfunction _iterableToArrayLimit(r, l) {\n  var t = null == r ? null : \"undefined\" != typeof Symbol && r[Symbol.iterator] || r[\"@@iterator\"];\n  if (null != t) {\n    var e,\n      n,\n      i,\n      u,\n      a = [],\n      f = true,\n      o = false;\n    try {\n      if (i = (t = t.call(r)).next, 0 === l) ; else for (; !(f = (e = i.call(t)).done) && (a.push(e.value), a.length !== l); f = !0);\n    } catch (r) {\n      o = true, n = r;\n    } finally {\n      try {\n        if (!f && null != t.return && (u = t.return(), Object(u) !== u)) return;\n      } finally {\n        if (o) throw n;\n      }\n    }\n    return a;\n  }\n}\nfunction _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}\nfunction _slicedToArray(r, e) {\n  return _arrayWithHoles(r) || _iterableToArrayLimit(r, e) || _unsupportedIterableToArray(r, e) || _nonIterableRest();\n}\nfunction _toConsumableArray(r) {\n  return _arrayWithoutHoles(r) || _iterableToArray(r) || _unsupportedIterableToArray(r) || _nonIterableSpread();\n}\nfunction _toPrimitive(t, r) {\n  if (\"object\" != typeof t || !t) return t;\n  var e = t[Symbol.toPrimitive];\n  if (void 0 !== e) {\n    var i = e.call(t, r);\n    if (\"object\" != typeof i) return i;\n    throw new TypeError(\"@@toPrimitive must return a primitive value.\");\n  }\n  return (\"string\" === r ? String : Number)(t);\n}\nfunction _toPropertyKey(t) {\n  var i = _toPrimitive(t, \"string\");\n  return \"symbol\" == typeof i ? i : i + \"\";\n}\nfunction _unsupportedIterableToArray(r, a) {\n  if (r) {\n    if (\"string\" == typeof r) return _arrayLikeToArray(r, a);\n    var t = {}.toString.call(r).slice(8, -1);\n    return \"Object\" === t && r.constructor && (t = r.constructor.name), \"Map\" === t || \"Set\" === t ? Array.from(r) : \"Arguments\" === t || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t) ? _arrayLikeToArray(r, a) : void 0;\n  }\n}\n\nvar three = window.THREE ? window.THREE // Prefer consumption from global THREE, if exists\n: {\n  WebGLRenderer: three__WEBPACK_IMPORTED_MODULE_3__.WebGLRenderer,\n  Scene: three__WEBPACK_IMPORTED_MODULE_4__.Scene,\n  PerspectiveCamera: three__WEBPACK_IMPORTED_MODULE_4__.PerspectiveCamera,\n  Raycaster: three__WEBPACK_IMPORTED_MODULE_4__.Raycaster,\n  SRGBColorSpace: three__WEBPACK_IMPORTED_MODULE_4__.SRGBColorSpace,\n  TextureLoader: three__WEBPACK_IMPORTED_MODULE_4__.TextureLoader,\n  Vector2: three__WEBPACK_IMPORTED_MODULE_4__.Vector2,\n  Vector3: three__WEBPACK_IMPORTED_MODULE_4__.Vector3,\n  Box3: three__WEBPACK_IMPORTED_MODULE_4__.Box3,\n  Color: three__WEBPACK_IMPORTED_MODULE_4__.Color,\n  Mesh: three__WEBPACK_IMPORTED_MODULE_4__.Mesh,\n  SphereGeometry: three__WEBPACK_IMPORTED_MODULE_4__.SphereGeometry,\n  MeshBasicMaterial: three__WEBPACK_IMPORTED_MODULE_4__.MeshBasicMaterial,\n  BackSide: three__WEBPACK_IMPORTED_MODULE_4__.BackSide,\n  Clock: three__WEBPACK_IMPORTED_MODULE_4__.Clock\n};\nvar threeRenderObjects = (0,kapsule__WEBPACK_IMPORTED_MODULE_5__[\"default\"])({\n  props: {\n    width: {\n      \"default\": window.innerWidth,\n      onChange: function onChange(width, state, prevWidth) {\n        isNaN(width) && (state.width = prevWidth);\n      }\n    },\n    height: {\n      \"default\": window.innerHeight,\n      onChange: function onChange(height, state, prevHeight) {\n        isNaN(height) && (state.height = prevHeight);\n      }\n    },\n    viewOffset: {\n      \"default\": [0, 0]\n    },\n    backgroundColor: {\n      \"default\": '#000011'\n    },\n    backgroundImageUrl: {},\n    onBackgroundImageLoaded: {},\n    showNavInfo: {\n      \"default\": true\n    },\n    skyRadius: {\n      \"default\": 50000\n    },\n    objects: {\n      \"default\": []\n    },\n    lights: {\n      \"default\": []\n    },\n    enablePointerInteraction: {\n      \"default\": true,\n      onChange: function onChange(_, state) {\n        // Reset hover state\n        state.hoverObj = null;\n        state.tooltip && state.tooltip.content(null);\n      },\n      triggerUpdate: false\n    },\n    pointerRaycasterThrottleMs: {\n      \"default\": 50,\n      triggerUpdate: false\n    },\n    lineHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    pointsHoverPrecision: {\n      \"default\": 1,\n      triggerUpdate: false\n    },\n    hoverOrderComparator: {\n      triggerUpdate: false\n    },\n    // keep existing order by default\n    hoverFilter: {\n      \"default\": function _default() {\n        return true;\n      },\n      triggerUpdate: false\n    },\n    // exclude objects from interaction\n    tooltipContent: {\n      triggerUpdate: false\n    },\n    hoverDuringDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    clickAfterDrag: {\n      \"default\": false,\n      triggerUpdate: false\n    },\n    onHover: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onClick: {\n      \"default\": function _default() {},\n      triggerUpdate: false\n    },\n    onRightClick: {\n      triggerUpdate: false\n    }\n  },\n  methods: {\n    tick: function tick(state) {\n      if (state.initialised) {\n        state.controls.enabled && state.controls.update && state.controls.update(Math.min(1, state.clock.getDelta())); // timedelta is required for fly controls\n\n        state.postProcessingComposer ? state.postProcessingComposer.render() // if using postprocessing, switch the output to it\n        : state.renderer.render(state.scene, state.camera);\n        state.extraRenderers.forEach(function (r) {\n          return r.render(state.scene, state.camera);\n        });\n        var now = +new Date();\n        if (state.enablePointerInteraction && now - state.lastRaycasterCheck >= state.pointerRaycasterThrottleMs) {\n          state.lastRaycasterCheck = now;\n          // Update tooltip and trigger onHover events\n          var topObject = null;\n          if (state.hoverDuringDrag || !state.isPointerDragging) {\n            var intersects = this.intersectingObjects(state.pointerPos.x, state.pointerPos.y);\n            state.hoverOrderComparator && intersects.sort(function (a, b) {\n              return state.hoverOrderComparator(a.object, b.object);\n            });\n            var topIntersect = intersects.find(function (d) {\n              return state.hoverFilter(d.object);\n            }) || null;\n            topObject = topIntersect ? topIntersect.object : null;\n            state.intersection = topIntersect || null;\n          }\n          if (topObject !== state.hoverObj) {\n            state.onHover(topObject, state.hoverObj, state.intersection);\n            state.tooltip.content(topObject ? (0,accessor_fn__WEBPACK_IMPORTED_MODULE_1__[\"default\"])(state.tooltipContent)(topObject, state.intersection) || null : null);\n            state.hoverObj = topObject;\n          }\n        }\n        state.tweenGroup.update(); // update camera animation tweens\n      }\n      return this;\n    },\n    getPointerPos: function getPointerPos(state) {\n      var _state$pointerPos = state.pointerPos,\n        x = _state$pointerPos.x,\n        y = _state$pointerPos.y;\n      return {\n        x: x,\n        y: y\n      };\n    },\n    cameraPosition: function cameraPosition(state, position, lookAt, transitionDuration) {\n      var camera = state.camera;\n\n      // Setter\n      if (position && state.initialised) {\n        var finalPos = position;\n        var finalLookAt = lookAt || {\n          x: 0,\n          y: 0,\n          z: 0\n        };\n        if (!transitionDuration) {\n          // no animation\n          setCameraPos(finalPos);\n          setLookAt(finalLookAt);\n        } else {\n          var camPos = Object.assign({}, camera.position);\n          var camLookAt = getLookAt();\n          state.tweenGroup.add(new _tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__.Tween(camPos).to(finalPos, transitionDuration).easing(_tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__.Easing.Quadratic.Out).onUpdate(setCameraPos).start());\n\n          // Face direction in 1/3rd of time\n          state.tweenGroup.add(new _tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__.Tween(camLookAt).to(finalLookAt, transitionDuration / 3).easing(_tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__.Easing.Quadratic.Out).onUpdate(setLookAt).start());\n        }\n        return this;\n      }\n\n      // Getter\n      return Object.assign({}, camera.position, {\n        lookAt: getLookAt()\n      });\n\n      //\n\n      function setCameraPos(pos) {\n        var x = pos.x,\n          y = pos.y,\n          z = pos.z;\n        if (x !== undefined) camera.position.x = x;\n        if (y !== undefined) camera.position.y = y;\n        if (z !== undefined) camera.position.z = z;\n      }\n      function setLookAt(lookAt) {\n        var lookAtVect = new three.Vector3(lookAt.x, lookAt.y, lookAt.z);\n        if (state.controls.enabled && state.controls.target) {\n          state.controls.target = lookAtVect;\n        } else {\n          // Fly controls doesn't have target attribute\n          camera.lookAt(lookAtVect); // note: lookAt may be overridden by other controls in some cases\n        }\n      }\n      function getLookAt() {\n        return Object.assign(new three.Vector3(0, 0, -1e3).applyQuaternion(camera.quaternion).add(camera.position));\n      }\n    },\n    zoomToFit: function zoomToFit(state) {\n      var transitionDuration = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n      var padding = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 10;\n      for (var _len = arguments.length, bboxArgs = new Array(_len > 3 ? _len - 3 : 0), _key = 3; _key < _len; _key++) {\n        bboxArgs[_key - 3] = arguments[_key];\n      }\n      return this.fitToBbox(this.getBbox.apply(this, bboxArgs), transitionDuration, padding);\n    },\n    fitToBbox: function fitToBbox(state, bbox) {\n      var transitionDuration = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n      var padding = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 10;\n      // based on https://discourse.threejs.org/t/camera-zoom-to-fit-object/936/24\n      var camera = state.camera;\n      if (bbox) {\n        var center = new three.Vector3(0, 0, 0); // reset camera aim to center\n        var maxBoxSide = Math.max.apply(Math, _toConsumableArray(Object.entries(bbox).map(function (_ref) {\n          var _ref2 = _slicedToArray(_ref, 2),\n            coordType = _ref2[0],\n            coords = _ref2[1];\n          return Math.max.apply(Math, _toConsumableArray(coords.map(function (c) {\n            return Math.abs(center[coordType] - c);\n          })));\n        }))) * 2;\n\n        // find distance that fits whole bbox within padded fov\n        var paddedFov = (1 - padding * 2 / state.height) * camera.fov;\n        var fitHeightDistance = maxBoxSide / Math.atan(paddedFov * Math.PI / 180);\n        var fitWidthDistance = fitHeightDistance / camera.aspect;\n        var distance = Math.max(fitHeightDistance, fitWidthDistance);\n        if (distance > 0) {\n          var newCameraPosition = center.clone().sub(camera.position).normalize().multiplyScalar(-distance);\n          this.cameraPosition(newCameraPosition, center, transitionDuration);\n        }\n      }\n      return this;\n    },\n    getBbox: function getBbox(state) {\n      var objFilter = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : function () {\n        return true;\n      };\n      var box = new three.Box3(new three.Vector3(0, 0, 0), new three.Vector3(0, 0, 0));\n      var objs = state.objects.filter(objFilter);\n      if (!objs.length) return null;\n      objs.forEach(function (obj) {\n        return box.expandByObject(obj);\n      });\n\n      // extract global x,y,z min/max\n      return Object.assign.apply(Object, _toConsumableArray(['x', 'y', 'z'].map(function (c) {\n        return _defineProperty({}, c, [box.min[c], box.max[c]]);\n      })));\n    },\n    getScreenCoords: function getScreenCoords(state, x, y, z) {\n      var vec = new three.Vector3(x, y, z);\n      vec.project(this.camera()); // project to the camera plane\n      return {\n        // align relative pos to canvas dimensions\n        x: (vec.x + 1) * state.width / 2,\n        y: -(vec.y - 1) * state.height / 2\n      };\n    },\n    getSceneCoords: function getSceneCoords(state, screenX, screenY) {\n      var distance = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;\n      var relCoords = new three.Vector2(screenX / state.width * 2 - 1, -(screenY / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.setFromCamera(relCoords, state.camera);\n      return Object.assign({}, raycaster.ray.at(distance, new three.Vector3()));\n    },\n    intersectingObjects: function intersectingObjects(state, x, y) {\n      var relCoords = new three.Vector2(x / state.width * 2 - 1, -(y / state.height) * 2 + 1);\n      var raycaster = new three.Raycaster();\n      raycaster.params.Line.threshold = state.lineHoverPrecision; // set linePrecision\n      raycaster.params.Points.threshold = state.pointsHoverPrecision; // set pointsPrecision\n      raycaster.setFromCamera(relCoords, state.camera);\n      return raycaster.intersectObjects(state.objects, true);\n    },\n    renderer: function renderer(state) {\n      return state.renderer;\n    },\n    scene: function scene(state) {\n      return state.scene;\n    },\n    camera: function camera(state) {\n      return state.camera;\n    },\n    postProcessingComposer: function postProcessingComposer(state) {\n      return state.postProcessingComposer;\n    },\n    controls: function controls(state) {\n      return state.controls;\n    },\n    tbControls: function tbControls(state) {\n      return state.controls;\n    } // to be deprecated\n  },\n  stateInit: function stateInit() {\n    return {\n      scene: new three.Scene(),\n      camera: new three.PerspectiveCamera(),\n      clock: new three.Clock(),\n      tweenGroup: new _tweenjs_tween_js__WEBPACK_IMPORTED_MODULE_0__.Group(),\n      lastRaycasterCheck: 0\n    };\n  },\n  init: function init(domNode, state) {\n    var _ref4 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},\n      _ref4$controlType = _ref4.controlType,\n      controlType = _ref4$controlType === void 0 ? 'trackball' : _ref4$controlType,\n      _ref4$useWebGPU = _ref4.useWebGPU,\n      useWebGPU = _ref4$useWebGPU === void 0 ? false : _ref4$useWebGPU,\n      _ref4$rendererConfig = _ref4.rendererConfig,\n      rendererConfig = _ref4$rendererConfig === void 0 ? {} : _ref4$rendererConfig,\n      _ref4$extraRenderers = _ref4.extraRenderers,\n      extraRenderers = _ref4$extraRenderers === void 0 ? [] : _ref4$extraRenderers,\n      _ref4$waitForLoadComp = _ref4.waitForLoadComplete,\n      waitForLoadComplete = _ref4$waitForLoadComp === void 0 ? true : _ref4$waitForLoadComp;\n    // Wipe DOM\n    domNode.innerHTML = '';\n\n    // Add relative container\n    domNode.appendChild(state.container = document.createElement('div'));\n    state.container.className = 'scene-container';\n    state.container.style.position = 'relative';\n\n    // Add nav info section\n    state.container.appendChild(state.navInfo = document.createElement('div'));\n    state.navInfo.className = 'scene-nav-info';\n    state.navInfo.textContent = {\n      orbit: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      trackball: 'Left-click: rotate, Mouse-wheel/middle-click: zoom, Right-click: pan',\n      fly: 'WASD: move, R|F: up | down, Q|E: roll, up|down: pitch, left|right: yaw'\n    }[controlType] || '';\n    state.navInfo.style.display = state.showNavInfo ? null : 'none';\n\n    // Setup tooltip\n    state.tooltip = new float_tooltip__WEBPACK_IMPORTED_MODULE_2__[\"default\"](state.container);\n\n    // Capture pointer coords on move or touchstart\n    state.pointerPos = new three.Vector2();\n    state.pointerPos.x = -2; // Initialize off canvas\n    state.pointerPos.y = -2;\n    ['pointermove', 'pointerdown'].forEach(function (evType) {\n      return state.container.addEventListener(evType, function (ev) {\n        // track click state\n        evType === 'pointerdown' && (state.isPointerPressed = true);\n\n        // detect point drag\n        !state.isPointerDragging && ev.type === 'pointermove' && (ev.pressure > 0 || state.isPointerPressed) // ev.pressure always 0 on Safari, so we used the isPointerPressed tracker\n        && (ev.pointerType === 'mouse' || ev.movementX === undefined || [ev.movementX, ev.movementY].some(function (m) {\n          return Math.abs(m) > 1;\n        })) // relax drag trigger sensitivity on non-mouse (touch/pen) events\n        && (state.isPointerDragging = true);\n        if (state.enablePointerInteraction) {\n          // update the pointer pos\n          var offset = getOffset(state.container);\n          state.pointerPos.x = ev.pageX - offset.left;\n          state.pointerPos.y = ev.pageY - offset.top;\n        }\n        function getOffset(el) {\n          var rect = el.getBoundingClientRect(),\n            scrollLeft = window.pageXOffset || document.documentElement.scrollLeft,\n            scrollTop = window.pageYOffset || document.documentElement.scrollTop;\n          return {\n            top: rect.top + scrollTop,\n            left: rect.left + scrollLeft\n          };\n        }\n      }, {\n        passive: true\n      });\n    });\n\n    // Handle click events on objs\n    state.container.addEventListener('pointerup', function (ev) {\n      if (!state.isPointerPressed) return; // don't trigger click events if pointer is not pressed on the canvas\n\n      state.isPointerPressed = false;\n      if (state.isPointerDragging) {\n        state.isPointerDragging = false;\n        if (!state.clickAfterDrag) return; // don't trigger onClick after pointer drag (camera motion via controls)\n      }\n      requestAnimationFrame(function () {\n        // trigger click events asynchronously, to allow hoverObj to be set (on frame)\n        if (ev.button === 0) {\n          // left-click\n          state.onClick(state.hoverObj || null, ev, state.intersection); // trigger background clicks with null\n        }\n        if (ev.button === 2 && state.onRightClick) {\n          // right-click\n          state.onRightClick(state.hoverObj || null, ev, state.intersection);\n        }\n      });\n    }, {\n      passive: true,\n      capture: true\n    }); // use capture phase to prevent propagation blocking from controls (specifically for fly)\n\n    state.container.addEventListener('contextmenu', function (ev) {\n      if (state.onRightClick) ev.preventDefault(); // prevent default contextmenu behavior and allow pointerup to fire instead\n    });\n\n    // Setup renderer, camera and controls\n    state.renderer = new (useWebGPU ? three_webgpu__WEBPACK_IMPORTED_MODULE_6__.WebGPURenderer : three.WebGLRenderer)(Object.assign({\n      antialias: true,\n      alpha: true\n    }, rendererConfig));\n    state.renderer.setPixelRatio(Math.min(2, window.devicePixelRatio)); // clamp device pixel ratio\n    state.container.appendChild(state.renderer.domElement);\n\n    // Setup extra renderers\n    state.extraRenderers = extraRenderers;\n    state.extraRenderers.forEach(function (r) {\n      // overlay them on top of main renderer\n      r.domElement.style.position = 'absolute';\n      r.domElement.style.top = '0px';\n      r.domElement.style.pointerEvents = 'none';\n      state.container.appendChild(r.domElement);\n    });\n\n    // configure post-processing composer\n    state.postProcessingComposer = new three_examples_jsm_postprocessing_EffectComposer_js__WEBPACK_IMPORTED_MODULE_7__.EffectComposer(state.renderer);\n    state.postProcessingComposer.addPass(new three_examples_jsm_postprocessing_RenderPass_js__WEBPACK_IMPORTED_MODULE_8__.RenderPass(state.scene, state.camera)); // render scene as first pass\n\n    // configure controls\n    state.controls = new {\n      trackball: three_examples_jsm_controls_TrackballControls_js__WEBPACK_IMPORTED_MODULE_9__.TrackballControls,\n      orbit: three_examples_jsm_controls_OrbitControls_js__WEBPACK_IMPORTED_MODULE_10__.OrbitControls,\n      fly: three_examples_jsm_controls_FlyControls_js__WEBPACK_IMPORTED_MODULE_11__.FlyControls\n    }[controlType](state.camera, state.renderer.domElement);\n    if (controlType === 'fly') {\n      state.controls.movementSpeed = 300;\n      state.controls.rollSpeed = Math.PI / 6;\n      state.controls.dragToLook = true;\n    }\n    if (controlType === 'trackball' || controlType === 'orbit') {\n      state.controls.minDistance = 0.1;\n      state.controls.maxDistance = state.skyRadius;\n      state.controls.addEventListener('start', function () {\n        state.controlsEngaged = true;\n      });\n      state.controls.addEventListener('change', function () {\n        if (state.controlsEngaged) {\n          state.controlsDragging = true;\n        }\n      });\n      state.controls.addEventListener('end', function () {\n        state.controlsEngaged = false;\n        state.controlsDragging = false;\n      });\n    }\n    [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n      return r.setSize(state.width, state.height);\n    });\n    state.camera.aspect = state.width / state.height;\n    state.camera.updateProjectionMatrix();\n    state.camera.position.z = 1000;\n\n    // add sky\n    state.scene.add(state.skysphere = new three.Mesh());\n    state.skysphere.visible = false;\n    state.loadComplete = state.scene.visible = !waitForLoadComplete;\n    window.scene = state.scene;\n  },\n  update: function update(state, changedProps) {\n    // resize canvas\n    if (state.width && state.height && (changedProps.hasOwnProperty('width') || changedProps.hasOwnProperty('height'))) {\n      var _state$camera;\n      var w = state.width;\n      var h = state.height;\n      state.container.style.width = \"\".concat(w, \"px\");\n      state.container.style.height = \"\".concat(h, \"px\");\n      [state.renderer, state.postProcessingComposer].concat(_toConsumableArray(state.extraRenderers)).forEach(function (r) {\n        return r.setSize(w, h);\n      });\n      state.camera.aspect = w / h;\n      var o = state.viewOffset.slice(0, 2);\n      o.some(function (n) {\n        return n;\n      }) && (_state$camera = state.camera).setViewOffset.apply(_state$camera, [w, h].concat(_toConsumableArray(o), [w, h]));\n      state.camera.updateProjectionMatrix();\n    }\n    if (changedProps.hasOwnProperty('viewOffset')) {\n      var _state$camera2;\n      var _w = state.width;\n      var _h = state.height;\n      var _o = state.viewOffset.slice(0, 2);\n      _o.some(function (n) {\n        return n;\n      }) ? (_state$camera2 = state.camera).setViewOffset.apply(_state$camera2, [_w, _h].concat(_toConsumableArray(_o), [_w, _h])) : state.camera.clearViewOffset();\n    }\n    if (changedProps.hasOwnProperty('skyRadius') && state.skyRadius) {\n      state.controls.hasOwnProperty('maxDistance') && changedProps.skyRadius && (state.controls.maxDistance = Math.min(state.controls.maxDistance, state.skyRadius));\n      state.camera.far = state.skyRadius * 2.5;\n      state.camera.updateProjectionMatrix();\n      state.skysphere.geometry = new three.SphereGeometry(state.skyRadius);\n    }\n    if (changedProps.hasOwnProperty('backgroundColor')) {\n      var alpha = (0,polished__WEBPACK_IMPORTED_MODULE_12__.parseToRgb)(state.backgroundColor).alpha;\n      if (alpha === undefined) alpha = 1;\n      state.renderer.setClearColor(new three.Color((0,polished__WEBPACK_IMPORTED_MODULE_12__.opacify)(1, state.backgroundColor)), alpha);\n    }\n    if (changedProps.hasOwnProperty('backgroundImageUrl')) {\n      if (!state.backgroundImageUrl) {\n        state.skysphere.visible = false;\n        state.skysphere.material.map = null;\n        !state.loadComplete && finishLoad();\n      } else {\n        new three.TextureLoader().load(state.backgroundImageUrl, function (texture) {\n          texture.colorSpace = three.SRGBColorSpace;\n          state.skysphere.material = new three.MeshBasicMaterial({\n            map: texture,\n            side: three.BackSide\n          });\n          state.skysphere.visible = true;\n\n          // triggered when background image finishes loading (asynchronously to allow 1 frame to load texture)\n          state.onBackgroundImageLoaded && setTimeout(state.onBackgroundImageLoaded);\n          !state.loadComplete && finishLoad();\n        });\n      }\n    }\n    changedProps.hasOwnProperty('showNavInfo') && (state.navInfo.style.display = state.showNavInfo ? null : 'none');\n    if (changedProps.hasOwnProperty('lights')) {\n      (changedProps.lights || []).forEach(function (light) {\n        return state.scene.remove(light);\n      }); // Clear the place\n      state.lights.forEach(function (light) {\n        return state.scene.add(light);\n      }); // Add to scene\n    }\n    if (changedProps.hasOwnProperty('objects')) {\n      (changedProps.objects || []).forEach(function (obj) {\n        return state.scene.remove(obj);\n      }); // Clear the place\n      state.objects.forEach(function (obj) {\n        return state.scene.add(obj);\n      }); // Add to scene\n    }\n\n    //\n\n    function finishLoad() {\n      state.loadComplete = state.scene.visible = true;\n    }\n  }\n});\n\n\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHNzcikvLi9ub2RlX21vZHVsZXMvdGhyZWUtcmVuZGVyLW9iamVjdHMvZGlzdC90aHJlZS1yZW5kZXItb2JqZWN0cy5tanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBbU07QUFDcko7QUFDdUM7QUFDUjtBQUNKO0FBQ1k7QUFDUjtBQUM5QjtBQUNVO0FBQ3BCO0FBQ1A7QUFDTTs7QUFFcEM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBO0FBQ0E7QUFDQSxJQUFJO0FBQ0o7QUFDQTtBQUNBOztBQUVBLGlDQUFpQyx1QkFBdUIsZ0JBQWdCLGdCQUFnQix1QkFBdUIscUJBQXFCLGlCQUFpQixvQkFBb0IsNEJBQTRCLHlCQUF5QixzQkFBc0IsR0FBRyxtQ0FBbUMsa0JBQWtCLEdBQUc7QUFDL1M7O0FBRUE7QUFDQTtBQUNBLGdDQUFnQyxPQUFPO0FBQ3ZDO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsK0NBQStDLFlBQVksa0VBQWtFO0FBQzdILE1BQU07QUFDTjtBQUNBLE1BQU07QUFDTjtBQUNBO0FBQ0EsUUFBUTtBQUNSO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxjQUFjO0FBQ2Q7QUFDQTtBQUNBOztBQUVBO0FB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QSxPQUFPLEdBQUc7QUFDVjtBQUNBO0FBQ0EsT0FBTyxHQUFHO0FBQ1Y7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxDQUFDOztBQUV3QyIsInNvdXJjZXMiOlsiL1VzZXJzL3N1cmFqcmF3YXQvRG93bmxvYWRzL1RyaXB5L25vZGVfbW9kdWxlcy90aHJlZS1yZW5kZXItb2JqZWN0cy9kaXN0L3RocmVlLXJlbmRlci1vYmplY3RzLm1qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTcGhlcmVHZW9tZXRyeSwgQ29sb3IsIFRleHR1cmVMb2FkZXIsIFNSR0JDb2xvclNwYWNlLCBNZXNoQmFzaWNNYXRlcmlhbCwgQmFja1NpZGUsIFZlY3RvcjIsIFdlYkdMUmVuZGVyZXIsIE1lc2gsIENsb2NrLCBQZXJzcGVjdGl2ZUNhbWVyYSwgU2NlbmUsIFJheWNhc3RlciwgVmVjdG9yMywgQm94MyB9IGZyb20gJ3RocmVlJztcbmltcG9ydCB7IFdlYkdQVVJlbmRlcmVyIH0gZnJvbSAndGhyZWUvd2ViZ3B1JztcbmltcG9ydCB7IFRyYWNrYmFsbENvbnRyb2xzIH0gZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL2NvbnRyb2xzL1RyYWNrYmFsbENvbnRyb2xzLmpzJztcbmltcG9ydCB7IE9yYml0Q29udHJvbHMgfSBmcm9tICd0aHJlZS9leGFtcGxlcy9qc20vY29udHJvbHMvT3JiaXRDb250cm9scy5qcyc7XG5pbXBvcnQgeyBGbHlDb250cm9scyB9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9jb250cm9scy9GbHlDb250cm9scy5qcyc7XG5pbXBvcnQgeyBFZmZlY3RDb21wb3NlciB9IGZyb20gJ3RocmVlL2V4YW1wbGVzL2pzbS9wb3N0cHJvY2Vzc2luZy9FZmZlY3RDb21wb3Nlci5qcyc7XG5pbXBvcnQgeyBSZW5kZXJQYXNzIH0gZnJvbSAndGhyZWUvZXhhbXBsZXMvanNtL3Bvc3Rwcm9jZXNzaW5nL1JlbmRlclBhc3MuanMnO1xuaW1wb3J0IHsgcGFyc2VUb1JnYiwgb3BhY2lmeSB9IGZyb20gJ3BvbGlzaGVkJztcbmltcG9ydCB7IEdyb3VwLCBUd2VlbiwgRWFzaW5nIH0gZnJvbSAnQHR3ZWVuanMvdHdlZW4uanMnO1xuaW1wb3J0IGFjY2Vzc29yRm4gZnJvbSAnYWNjZXNzb3ItZm4nO1xuaW1wb3J0IEthcHN1bGUgZnJvbSAna2Fwc3VsZSc7XG5pbXBvcnQgVG9vbHRpcCBmcm9tICdmbG9hdC10b29sdGlwJztcblxuZnVuY3Rpb24gc3R5bGVJbmplY3QoY3NzLCByZWYpIHtcbiAgaWYgKHJlZiA9PT0gdm9pZCAwKSByZWYgPSB7fTtcbiAgdmFyIGluc2VydEF0ID0gcmVmLmluc2VydEF0O1xuICBpZiAodHlwZW9mIGRvY3VtZW50ID09PSAndW5kZWZpbmVkJykge1xuICAgIHJldHVybjtcbiAgfVxuICB2YXIgaGVhZCA9IGRvY3VtZW50LmhlYWQgfHwgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2hlYWQnKVswXTtcbiAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTtcbiAgc3R5bGUudHlwZSA9ICd0ZXh0L2Nzcyc7XG4gIGlmIChpbnNlcnRBdCA9PT0gJ3RvcCcpIHtcbiAgICBpZiAoaGVhZC5maXJzdENoaWxkKSB7XG4gICAgICBoZWFkLmluc2VydEJlZm9yZShzdHlsZSwgaGVhZC5maXJzdENoaWxkKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaGVhZC5hcHBlbmRDaGlsZChzdHlsZSk7XG4gICAgfVxuICB9IGVsc2Uge1xuICAgIGhlYWQuYXBwZW5kQ2hpbGQoc3R5bGUpO1xuICB9XG4gIGlmIChzdHlsZS5zdHlsZVNoZWV0KSB7XG4gICAgc3R5bGUuc3R5bGVTaGVldC5jc3NUZXh0ID0gY3NzO1xuICB9IGVsc2Uge1xuICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNzcykpO1xuICB9XG59XG5cbnZhciBjc3NfMjQ4eiA9IFwiLnNjZW5lLW5hdi1pbmZvIHtcXG4gIHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG4gIGJvdHRvbTogNXB4O1xcbiAgd2lkdGg6IDEwMCU7XFxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XFxuICBjb2xvcjogc2xhdGVncmV5O1xcbiAgb3BhY2l0eTogMC43O1xcbiAgZm9udC1zaXplOiAxMHB4O1xcbiAgZm9udC1mYW1pbHk6IHNhbnMtc2VyaWY7XFxuICBwb2ludGVyLWV2ZW50czogbm9uZTtcXG4gIHVzZXItc2VsZWN0OiBub25lO1xcbn1cXG5cXG4uc2NlbmUtY29udGFpbmVyIGNhbnZhczpmb2N1cyB7XFxuICBvdXRsaW5lOiBub25lO1xcbn1cIjtcbnN0eWxlSW5qZWN0KGNzc18yNDh6KTtcblxuZnVuY3Rpb24gX2FycmF5TGlrZVRvQXJyYXkociwgYSkge1xuICAobnVsbCA9PSBhIHx8IGEgPiByLmxlbmd0aCkgJiYgKGEgPSByLmxlbmd0aCk7XG4gIGZvciAodmFyIGUgPSAwLCBuID0gQXJyYXkoYSk7IGUgPCBhOyBlKyspIG5bZV0gPSByW2VdO1xuICByZXR1cm4gbjtcbn1cbmZ1bmN0aW9uIF9hcnJheVdpdGhIb2xlcyhyKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHIpKSByZXR1cm4gcjtcbn1cbmZ1bmN0aW9uIF9hcnJheVdpdGhvdXRIb2xlcyhyKSB7XG4gIGlmIChBcnJheS5pc0FycmF5KHIpKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkocik7XG59XG5mdW5jdGlvbiBfZGVmaW5lUHJvcGVydHkoZSwgciwgdCkge1xuICByZXR1cm4gKHIgPSBfdG9Qcm9wZXJ0eUtleShyKSkgaW4gZSA/IE9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLCByLCB7XG4gICAgdmFsdWU6IHQsXG4gICAgZW51bWVyYWJsZTogdHJ1ZSxcbiAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgd3JpdGFibGU6IHRydWVcbiAgfSkgOiBlW3JdID0gdCwgZTtcbn1cbmZ1bmN0aW9uIF9pdGVyYWJsZVRvQXJyYXkocikge1xuICBpZiAoXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgU3ltYm9sICYmIG51bGwgIT0gcltTeW1ib2wuaXRlcmF0b3JdIHx8IG51bGwgIT0gcltcIkBAaXRlcmF0b3JcIl0pIHJldHVybiBBcnJheS5mcm9tKHIpO1xufVxuZnVuY3Rpb24gX2l0ZXJhYmxlVG9BcnJheUxpbWl0KHIsIGwpIHtcbiAgdmFyIHQgPSBudWxsID09IHIgPyBudWxsIDogXCJ1bmRlZmluZWRcIiAhPSB0eXBlb2YgU3ltYm9sICYmIHJbU3ltYm9sLml0ZXJhdG9yXSB8fCByW1wiQEBpdGVyYXRvclwiXTtcbiAgaWYgKG51bGwgIT0gdCkge1xuICAgIHZhciBlLFxuICAgICAgbixcbiAgICAgIGksXG4gICAgICB1LFxuICAgICAgYSA9IFtdLFxuICAgICAgZiA9IHRydWUsXG4gICAgICBvID0gZmFsc2U7XG4gICAgdHJ5IHtcbiAgICAgIGlmIChpID0gKHQgPSB0LmNhbGwocikpLm5leHQsIDAgPT09IGwpIDsgZWxzZSBmb3IgKDsgIShmID0gKGUgPSBpLmNhbGwodCkpLmRvbmUpICYmIChhLnB1c2goZS52YWx1ZSksIGEubGVuZ3RoICE9PSBsKTsgZiA9ICEwKTtcbiAgICB9IGNhdGNoIChyKSB7XG4gICAgICBvID0gdHJ1ZSwgbiA9IHI7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGlmICghZiAmJiBudWxsICE9IHQucmV0dXJuICYmICh1ID0gdC5yZXR1cm4oKSwgT2JqZWN0KHUpICE9PSB1KSkgcmV0dXJuO1xuICAgICAgfSBmaW5hbGx5IHtcbiAgICAgICAgaWYgKG8pIHRocm93IG47XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBhO1xuICB9XG59XG5mdW5jdGlvbiBfbm9uSXRlcmFibGVSZXN0KCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIGRlc3RydWN0dXJlIG5vbi1pdGVyYWJsZSBpbnN0YW5jZS5cXG5JbiBvcmRlciB0byBiZSBpdGVyYWJsZSwgbm9uLWFycmF5IG9iamVjdHMgbXVzdCBoYXZlIGEgW1N5bWJvbC5pdGVyYXRvcl0oKSBtZXRob2QuXCIpO1xufVxuZnVuY3Rpb24gX25vbkl0ZXJhYmxlU3ByZWFkKCkge1xuICB0aHJvdyBuZXcgVHlwZUVycm9yKFwiSW52YWxpZCBhdHRlbXB0IHRvIHNwcmVhZCBub24taXRlcmFibGUgaW5zdGFuY2UuXFxuSW4gb3JkZXIgdG8gYmUgaXRlcmFibGUsIG5vbi1hcnJheSBvYmplY3RzIG11c3QgaGF2ZSBhIFtTeW1ib2wuaXRlcmF0b3JdKCkgbWV0aG9kLlwiKTtcbn1cbmZ1bmN0aW9uIF9zbGljZWRUb0FycmF5KHIsIGUpIHtcbiAgcmV0dXJuIF9hcnJheVdpdGhIb2xlcyhyKSB8fCBfaXRlcmFibGVUb0FycmF5TGltaXQociwgZSkgfHwgX3Vuc3VwcG9ydGVkSXRlcmFibGVUb0FycmF5KHIsIGUpIHx8IF9ub25JdGVyYWJsZVJlc3QoKTtcbn1cbmZ1bmN0aW9uIF90b0NvbnN1bWFibGVBcnJheShyKSB7XG4gIHJldHVybiBfYXJyYXlXaXRob3V0SG9sZXMocikgfHwgX2l0ZXJhYmxlVG9BcnJheShyKSB8fCBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkocikgfHwgX25vbkl0ZXJhYmxlU3ByZWFkKCk7XG59XG5mdW5jdGlvbiBfdG9QcmltaXRpdmUodCwgcikge1xuICBpZiAoXCJvYmplY3RcIiAhPSB0eXBlb2YgdCB8fCAhdCkgcmV0dXJuIHQ7XG4gIHZhciBlID0gdFtTeW1ib2wudG9QcmltaXRpdmVdO1xuICBpZiAodm9pZCAwICE9PSBlKSB7XG4gICAgdmFyIGkgPSBlLmNhbGwodCwgcik7XG4gICAgaWYgKFwib2JqZWN0XCIgIT0gdHlwZW9mIGkpIHJldHVybiBpO1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJAQHRvUHJpbWl0aXZlIG11c3QgcmV0dXJuIGEgcHJpbWl0aXZlIHZhbHVlLlwiKTtcbiAgfVxuICByZXR1cm4gKFwic3RyaW5nXCIgPT09IHIgPyBTdHJpbmcgOiBOdW1iZXIpKHQpO1xufVxuZnVuY3Rpb24gX3RvUHJvcGVydHlLZXkodCkge1xuICB2YXIgaSA9IF90b1ByaW1pdGl2ZSh0LCBcInN0cmluZ1wiKTtcbiAgcmV0dXJuIFwic3ltYm9sXCIgPT0gdHlwZW9mIGkgPyBpIDogaSArIFwiXCI7XG59XG5mdW5jdGlvbiBfdW5zdXBwb3J0ZWRJdGVyYWJsZVRvQXJyYXkociwgYSkge1xuICBpZiAocikge1xuICAgIGlmIChcInN0cmluZ1wiID09IHR5cGVvZiByKSByZXR1cm4gX2FycmF5TGlrZVRvQXJyYXkociwgYSk7XG4gICAgdmFyIHQgPSB7fS50b1N0cmluZy5jYWxsKHIpLnNsaWNlKDgsIC0xKTtcbiAgICByZXR1cm4gXCJPYmplY3RcIiA9PT0gdCAmJiByLmNvbnN0cnVjdG9yICYmICh0ID0gci5jb25zdHJ1Y3Rvci5uYW1lKSwgXCJNYXBcIiA9PT0gdCB8fCBcIlNldFwiID09PSB0ID8gQXJyYXkuZnJvbShyKSA6IFwiQXJndW1lbnRzXCIgPT09IHQgfHwgL14oPzpVaXxJKW50KD86OHwxNnwzMikoPzpDbGFtcGVkKT9BcnJheSQvLnRlc3QodCkgPyBfYXJyYXlMaWtlVG9BcnJheShyLCBhKSA6IHZvaWQgMDtcbiAgfVxufVxuXG52YXIgdGhyZWUgPSB3aW5kb3cuVEhSRUUgPyB3aW5kb3cuVEhSRUUgLy8gUHJlZmVyIGNvbnN1bXB0aW9uIGZyb20gZ2xvYmFsIFRIUkVFLCBpZiBleGlzdHNcbjoge1xuICBXZWJHTFJlbmRlcmVyOiBXZWJHTFJlbmRlcmVyLFxuICBTY2VuZTogU2NlbmUsXG4gIFBlcnNwZWN0aXZlQ2FtZXJhOiBQZXJzcGVjdGl2ZUNhbWVyYSxcbiAgUmF5Y2FzdGVyOiBSYXljYXN0ZXIsXG4gIFNSR0JDb2xvclNwYWNlOiBTUkdCQ29sb3JTcGFjZSxcbiAgVGV4dHVyZUxvYWRlcjogVGV4dHVyZUxvYWRlcixcbiAgVmVjdG9yMjogVmVjdG9yMixcbiAgVmVjdG9yMzogVmVjdG9yMyxcbiAgQm94MzogQm94MyxcbiAgQ29sb3I6IENvbG9yLFxuICBNZXNoOiBNZXNoLFxuICBTcGhlcmVHZW9tZXRyeTogU3BoZXJlR2VvbWV0cnksXG4gIE1lc2hCYXNpY01hdGVyaWFsOiBNZXNoQmFzaWNNYXRlcmlhbCxcbiAgQmFja1NpZGU6IEJhY2tTaWRlLFxuICBDbG9jazogQ2xvY2tcbn07XG52YXIgdGhyZWVSZW5kZXJPYmplY3RzID0gS2Fwc3VsZSh7XG4gIHByb3BzOiB7XG4gICAgd2lkdGg6IHtcbiAgICAgIFwiZGVmYXVsdFwiOiB3aW5kb3cuaW5uZXJXaWR0aCxcbiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZSh3aWR0aCwgc3RhdGUsIHByZXZXaWR0aCkge1xuICAgICAgICBpc05hTih3aWR0aCkgJiYgKHN0YXRlLndpZHRoID0gcHJldldpZHRoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGhlaWdodDoge1xuICAgICAgXCJkZWZhdWx0XCI6IHdpbmRvdy5pbm5lckhlaWdodCxcbiAgICAgIG9uQ2hhbmdlOiBmdW5jdGlvbiBvbkNoYW5nZShoZWlnaHQsIHN0YXRlLCBwcmV2SGVpZ2h0KSB7XG4gICAgICAgIGlzTmFOKGhlaWdodCkgJiYgKHN0YXRlLmhlaWdodCA9IHByZXZIZWlnaHQpO1xuICAgICAgfVxuICAgIH0sXG4gICAgdmlld09mZnNldDoge1xuICAgICAgXCJkZWZhdWx0XCI6IFswLCAwXVxuICAgIH0sXG4gICAgYmFja2dyb3VuZENvbG9yOiB7XG4gICAgICBcImRlZmF1bHRcIjogJyMwMDAwMTEnXG4gICAgfSxcbiAgICBiYWNrZ3JvdW5kSW1hZ2VVcmw6IHt9LFxuICAgIG9uQmFja2dyb3VuZEltYWdlTG9hZGVkOiB7fSxcbiAgICBzaG93TmF2SW5mbzoge1xuICAgICAgXCJkZWZhdWx0XCI6IHRydWVcbiAgICB9LFxuICAgIHNreVJhZGl1czoge1xuICAgICAgXCJkZWZhdWx0XCI6IDUwMDAwXG4gICAgfSxcbiAgICBvYmplY3RzOiB7XG4gICAgICBcImRlZmF1bHRcIjogW11cbiAgICB9LFxuICAgIGxpZ2h0czoge1xuICAgICAgXCJkZWZhdWx0XCI6IFtdXG4gICAgfSxcbiAgICBlbmFibGVQb2ludGVySW50ZXJhY3Rpb246IHtcbiAgICAgIFwiZGVmYXVsdFwiOiB0cnVlLFxuICAgICAgb25DaGFuZ2U6IGZ1bmN0aW9uIG9uQ2hhbmdlKF8sIHN0YXRlKSB7XG4gICAgICAgIC8vIFJlc2V0IGhvdmVyIHN0YXRlXG4gICAgICAgIHN0YXRlLmhvdmVyT2JqID0gbnVsbDtcbiAgICAgICAgc3RhdGUudG9vbHRpcCAmJiBzdGF0ZS50b29sdGlwLmNvbnRlbnQobnVsbCk7XG4gICAgICB9LFxuICAgICAgdHJpZ2dlclVwZGF0ZTogZmFsc2VcbiAgICB9LFxuICAgIHBvaW50ZXJSYXljYXN0ZXJUaHJvdHRsZU1zOiB7XG4gICAgICBcImRlZmF1bHRcIjogNTAsXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgbGluZUhvdmVyUHJlY2lzaW9uOiB7XG4gICAgICBcImRlZmF1bHRcIjogMSxcbiAgICAgIHRyaWdnZXJVcGRhdGU6IGZhbHNlXG4gICAgfSxcbiAgICBwb2ludHNIb3ZlclByZWNpc2lvbjoge1xuICAgICAgXCJkZWZhdWx0XCI6IDEsXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgaG92ZXJPcmRlckNvbXBhcmF0b3I6IHtcbiAgICAgIHRyaWdnZXJVcGRhdGU6IGZhbHNlXG4gICAgfSxcbiAgICAvLyBrZWVwIGV4aXN0aW5nIG9yZGVyIGJ5IGRlZmF1bHRcbiAgICBob3ZlckZpbHRlcjoge1xuICAgICAgXCJkZWZhdWx0XCI6IGZ1bmN0aW9uIF9kZWZhdWx0KCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH0sXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgLy8gZXhjbHVkZSBvYmplY3RzIGZyb20gaW50ZXJhY3Rpb25cbiAgICB0b29sdGlwQ29udGVudDoge1xuICAgICAgdHJpZ2dlclVwZGF0ZTogZmFsc2VcbiAgICB9LFxuICAgIGhvdmVyRHVyaW5nRHJhZzoge1xuICAgICAgXCJkZWZhdWx0XCI6IGZhbHNlLFxuICAgICAgdHJpZ2dlclVwZGF0ZTogZmFsc2VcbiAgICB9LFxuICAgIGNsaWNrQWZ0ZXJEcmFnOiB7XG4gICAgICBcImRlZmF1bHRcIjogZmFsc2UsXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgb25Ib3Zlcjoge1xuICAgICAgXCJkZWZhdWx0XCI6IGZ1bmN0aW9uIF9kZWZhdWx0KCkge30sXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgb25DbGljazoge1xuICAgICAgXCJkZWZhdWx0XCI6IGZ1bmN0aW9uIF9kZWZhdWx0KCkge30sXG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH0sXG4gICAgb25SaWdodENsaWNrOiB7XG4gICAgICB0cmlnZ2VyVXBkYXRlOiBmYWxzZVxuICAgIH1cbiAgfSxcbiAgbWV0aG9kczoge1xuICAgIHRpY2s6IGZ1bmN0aW9uIHRpY2soc3RhdGUpIHtcbiAgICAgIGlmIChzdGF0ZS5pbml0aWFsaXNlZCkge1xuICAgICAgICBzdGF0ZS5jb250cm9scy5lbmFibGVkICYmIHN0YXRlLmNvbnRyb2xzLnVwZGF0ZSAmJiBzdGF0ZS5jb250cm9scy51cGRhdGUoTWF0aC5taW4oMSwgc3RhdGUuY2xvY2suZ2V0RGVsdGEoKSkpOyAvLyB0aW1lZGVsdGEgaXMgcmVxdWlyZWQgZm9yIGZseSBjb250cm9sc1xuXG4gICAgICAgIHN0YXRlLnBvc3RQcm9jZXNzaW5nQ29tcG9zZXIgPyBzdGF0ZS5wb3N0UHJvY2Vzc2luZ0NvbXBvc2VyLnJlbmRlcigpIC8vIGlmIHVzaW5nIHBvc3Rwcm9jZXNzaW5nLCBzd2l0Y2ggdGhlIG91dHB1dCB0byBpdFxuICAgICAgICA6IHN0YXRlLnJlbmRlcmVyLnJlbmRlcihzdGF0ZS5zY2VuZSwgc3RhdGUuY2FtZXJhKTtcbiAgICAgICAgc3RhdGUuZXh0cmFSZW5kZXJlcnMuZm9yRWFjaChmdW5jdGlvbiAocikge1xuICAgICAgICAgIHJldHVybiByLnJlbmRlcihzdGF0ZS5zY2VuZSwgc3RhdGUuY2FtZXJhKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciBub3cgPSArbmV3IERhdGUoKTtcbiAgICAgICAgaWYgKHN0YXRlLmVuYWJsZVBvaW50ZXJJbnRlcmFjdGlvbiAmJiBub3cgLSBzdGF0ZS5sYXN0UmF5Y2FzdGVyQ2hlY2sgPj0gc3RhdGUucG9pbnRlclJheWNhc3RlclRocm90dGxlTXMpIHtcbiAgICAgICAgICBzdGF0ZS5sYXN0UmF5Y2FzdGVyQ2hlY2sgPSBub3c7XG4gICAgICAgICAgLy8gVXBkYXRlIHRvb2x0aXAgYW5kIHRyaWdnZXIgb25Ib3ZlciBldmVudHNcbiAgICAgICAgICB2YXIgdG9wT2JqZWN0ID0gbnVsbDtcbiAgICAgICAgICBpZiAoc3RhdGUuaG92ZXJEdXJpbmdEcmFnIHx8ICFzdGF0ZS5pc1BvaW50ZXJEcmFnZ2luZykge1xuICAgICAgICAgICAgdmFyIGludGVyc2VjdHMgPSB0aGlzLmludGVyc2VjdGluZ09iamVjdHMoc3RhdGUucG9pbnRlclBvcy54LCBzdGF0ZS5wb2ludGVyUG9zLnkpO1xuICAgICAgICAgICAgc3RhdGUuaG92ZXJPcmRlckNvbXBhcmF0b3IgJiYgaW50ZXJzZWN0cy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5ob3Zlck9yZGVyQ29tcGFyYXRvcihhLm9iamVjdCwgYi5vYmplY3QpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB2YXIgdG9wSW50ZXJzZWN0ID0gaW50ZXJzZWN0cy5maW5kKGZ1bmN0aW9uIChkKSB7XG4gICAgICAgICAgICAgIHJldHVybiBzdGF0ZS5ob3ZlckZpbHRlcihkLm9iamVjdCk7XG4gICAgICAgICAgICB9KSB8fCBudWxsO1xuICAgICAgICAgICAgdG9wT2JqZWN0ID0gdG9wSW50ZXJzZWN0ID8gdG9wSW50ZXJzZWN0Lm9iamVjdCA6IG51bGw7XG4gICAgICAgICAgICBzdGF0ZS5pbnRlcnNlY3Rpb24gPSB0b3BJbnRlcnNlY3QgfHwgbnVsbDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKHRvcE9iamVjdCAhPT0gc3RhdGUuaG92ZXJPYmopIHtcbiAgICAgICAgICAgIHN0YXRlLm9uSG92ZXIodG9wT2JqZWN0LCBzdGF0ZS5ob3Zlck9iaiwgc3RhdGUuaW50ZXJzZWN0aW9uKTtcbiAgICAgICAgICAgIHN0YXRlLnRvb2x0aXAuY29udGVudCh0b3BPYmplY3QgPyBhY2Nlc3NvckZuKHN0YXRlLnRvb2x0aXBDb250ZW50KSh0b3BPYmplY3QsIHN0YXRlLmludGVyc2VjdGlvbikgfHwgbnVsbCA6IG51bGwpO1xuICAgICAgICAgICAgc3RhdGUuaG92ZXJPYmogPSB0b3BPYmplY3Q7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHN0YXRlLnR3ZWVuR3JvdXAudXBkYXRlKCk7IC8vIHVwZGF0ZSBjYW1lcmEgYW5pbWF0aW9uIHR3ZWVuc1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBnZXRQb2ludGVyUG9zOiBmdW5jdGlvbiBnZXRQb2ludGVyUG9zKHN0YXRlKSB7XG4gICAgICB2YXIgX3N0YXRlJHBvaW50ZXJQb3MgPSBzdGF0ZS5wb2ludGVyUG9zLFxuICAgICAgICB4ID0gX3N0YXRlJHBvaW50ZXJQb3MueCxcbiAgICAgICAgeSA9IF9zdGF0ZSRwb2ludGVyUG9zLnk7XG4gICAgICByZXR1cm4ge1xuICAgICAgICB4OiB4LFxuICAgICAgICB5OiB5XG4gICAgICB9O1xuICAgIH0sXG4gICAgY2FtZXJhUG9zaXRpb246IGZ1bmN0aW9uIGNhbWVyYVBvc2l0aW9uKHN0YXRlLCBwb3NpdGlvbiwgbG9va0F0LCB0cmFuc2l0aW9uRHVyYXRpb24pIHtcbiAgICAgIHZhciBjYW1lcmEgPSBzdGF0ZS5jYW1lcmE7XG5cbiAgICAgIC8vIFNldHRlclxuICAgICAgaWYgKHBvc2l0aW9uICYmIHN0YXRlLmluaXRpYWxpc2VkKSB7XG4gICAgICAgIHZhciBmaW5hbFBvcyA9IHBvc2l0aW9uO1xuICAgICAgICB2YXIgZmluYWxMb29rQXQgPSBsb29rQXQgfHwge1xuICAgICAgICAgIHg6IDAsXG4gICAgICAgICAgeTogMCxcbiAgICAgICAgICB6OiAwXG4gICAgICAgIH07XG4gICAgICAgIGlmICghdHJhbnNpdGlvbkR1cmF0aW9uKSB7XG4gICAgICAgICAgLy8gbm8gYW5pbWF0aW9uXG4gICAgICAgICAgc2V0Q2FtZXJhUG9zKGZpbmFsUG9zKTtcbiAgICAgICAgICBzZXRMb29rQXQoZmluYWxMb29rQXQpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBjYW1Qb3MgPSBPYmplY3QuYXNzaWduKHt9LCBjYW1lcmEucG9zaXRpb24pO1xuICAgICAgICAgIHZhciBjYW1Mb29rQXQgPSBnZXRMb29rQXQoKTtcbiAgICAgICAgICBzdGF0ZS50d2Vlbkdyb3VwLmFkZChuZXcgVHdlZW4oY2FtUG9zKS50byhmaW5hbFBvcywgdHJhbnNpdGlvbkR1cmF0aW9uKS5lYXNpbmcoRWFzaW5nLlF1YWRyYXRpYy5PdXQpLm9uVXBkYXRlKHNldENhbWVyYVBvcykuc3RhcnQoKSk7XG5cbiAgICAgICAgICAvLyBGYWNlIGRpcmVjdGlvbiBpbiAxLzNyZCBvZiB0aW1lXG4gICAgICAgICAgc3RhdGUudHdlZW5Hcm91cC5hZGQobmV3IFR3ZWVuKGNhbUxvb2tBdCkudG8oZmluYWxMb29rQXQsIHRyYW5zaXRpb25EdXJhdGlvbiAvIDMpLmVhc2luZyhFYXNpbmcuUXVhZHJhdGljLk91dCkub25VcGRhdGUoc2V0TG9va0F0KS5zdGFydCgpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdGhpcztcbiAgICAgIH1cblxuICAgICAgLy8gR2V0dGVyXG4gICAgICByZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgY2FtZXJhLnBvc2l0aW9uLCB7XG4gICAgICAgIGxvb2tBdDogZ2V0TG9va0F0KClcbiAgICAgIH0pO1xuXG4gICAgICAvL1xuXG4gICAgICBmdW5jdGlvbiBzZXRDYW1lcmFQb3MocG9zKSB7XG4gICAgICAgIHZhciB4ID0gcG9zLngsXG4gICAgICAgICAgeSA9IHBvcy55LFxuICAgICAgICAgIHogPSBwb3MuejtcbiAgICAgICAgaWYgKHggIT09IHVuZGVmaW5lZCkgY2FtZXJhLnBvc2l0aW9uLnggPSB4O1xuICAgICAgICBpZiAoeSAhPT0gdW5kZWZpbmVkKSBjYW1lcmEucG9zaXRpb24ueSA9IHk7XG4gICAgICAgIGlmICh6ICE9PSB1bmRlZmluZWQpIGNhbWVyYS5wb3NpdGlvbi56ID0gejtcbiAgICAgIH1cbiAgICAgIGZ1bmN0aW9uIHNldExvb2tBdChsb29rQXQpIHtcbiAgICAgICAgdmFyIGxvb2tBdFZlY3QgPSBuZXcgdGhyZWUuVmVjdG9yMyhsb29rQXQueCwgbG9va0F0LnksIGxvb2tBdC56KTtcbiAgICAgICAgaWYgKHN0YXRlLmNvbnRyb2xzLmVuYWJsZWQgJiYgc3RhdGUuY29udHJvbHMudGFyZ2V0KSB7XG4gICAgICAgICAgc3RhdGUuY29udHJvbHMudGFyZ2V0ID0gbG9va0F0VmVjdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAvLyBGbHkgY29udHJvbHMgZG9lc24ndCBoYXZlIHRhcmdldCBhdHRyaWJ1dGVcbiAgICAgICAgICBjYW1lcmEubG9va0F0KGxvb2tBdFZlY3QpOyAvLyBub3RlOiBsb29rQXQgbWF5IGJlIG92ZXJyaWRkZW4gYnkgb3RoZXIgY29udHJvbHMgaW4gc29tZSBjYXNlc1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBmdW5jdGlvbiBnZXRMb29rQXQoKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuYXNzaWduKG5ldyB0aHJlZS5WZWN0b3IzKDAsIDAsIC0xZTMpLmFwcGx5UXVhdGVybmlvbihjYW1lcmEucXVhdGVybmlvbikuYWRkKGNhbWVyYS5wb3NpdGlvbikpO1xuICAgICAgfVxuICAgIH0sXG4gICAgem9vbVRvRml0OiBmdW5jdGlvbiB6b29tVG9GaXQoc3RhdGUpIHtcbiAgICAgIHZhciB0cmFuc2l0aW9uRHVyYXRpb24gPSBhcmd1bWVudHMubGVuZ3RoID4gMSAmJiBhcmd1bWVudHNbMV0gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1sxXSA6IDA7XG4gICAgICB2YXIgcGFkZGluZyA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTA7XG4gICAgICBmb3IgKHZhciBfbGVuID0gYXJndW1lbnRzLmxlbmd0aCwgYmJveEFyZ3MgPSBuZXcgQXJyYXkoX2xlbiA+IDMgPyBfbGVuIC0gMyA6IDApLCBfa2V5ID0gMzsgX2tleSA8IF9sZW47IF9rZXkrKykge1xuICAgICAgICBiYm94QXJnc1tfa2V5IC0gM10gPSBhcmd1bWVudHNbX2tleV07XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcy5maXRUb0Jib3godGhpcy5nZXRCYm94LmFwcGx5KHRoaXMsIGJib3hBcmdzKSwgdHJhbnNpdGlvbkR1cmF0aW9uLCBwYWRkaW5nKTtcbiAgICB9LFxuICAgIGZpdFRvQmJveDogZnVuY3Rpb24gZml0VG9CYm94KHN0YXRlLCBiYm94KSB7XG4gICAgICB2YXIgdHJhbnNpdGlvbkR1cmF0aW9uID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiAwO1xuICAgICAgdmFyIHBhZGRpbmcgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IDEwO1xuICAgICAgLy8gYmFzZWQgb24gaHR0cHM6Ly9kaXNjb3Vyc2UudGhyZWVqcy5vcmcvdC9jYW1lcmEtem9vbS10by1maXQtb2JqZWN0LzkzNi8yNFxuICAgICAgdmFyIGNhbWVyYSA9IHN0YXRlLmNhbWVyYTtcbiAgICAgIGlmIChiYm94KSB7XG4gICAgICAgIHZhciBjZW50ZXIgPSBuZXcgdGhyZWUuVmVjdG9yMygwLCAwLCAwKTsgLy8gcmVzZXQgY2FtZXJhIGFpbSB0byBjZW50ZXJcbiAgICAgICAgdmFyIG1heEJveFNpZGUgPSBNYXRoLm1heC5hcHBseShNYXRoLCBfdG9Db25zdW1hYmxlQXJyYXkoT2JqZWN0LmVudHJpZXMoYmJveCkubWFwKGZ1bmN0aW9uIChfcmVmKSB7XG4gICAgICAgICAgdmFyIF9yZWYyID0gX3NsaWNlZFRvQXJyYXkoX3JlZiwgMiksXG4gICAgICAgICAgICBjb29yZFR5cGUgPSBfcmVmMlswXSxcbiAgICAgICAgICAgIGNvb3JkcyA9IF9yZWYyWzFdO1xuICAgICAgICAgIHJldHVybiBNYXRoLm1heC5hcHBseShNYXRoLCBfdG9Db25zdW1hYmxlQXJyYXkoY29vcmRzLm1hcChmdW5jdGlvbiAoYykge1xuICAgICAgICAgICAgcmV0dXJuIE1hdGguYWJzKGNlbnRlcltjb29yZFR5cGVdIC0gYyk7XG4gICAgICAgICAgfSkpKTtcbiAgICAgICAgfSkpKSAqIDI7XG5cbiAgICAgICAgLy8gZmluZCBkaXN0YW5jZSB0aGF0IGZpdHMgd2hvbGUgYmJveCB3aXRoaW4gcGFkZGVkIGZvdlxuICAgICAgICB2YXIgcGFkZGVkRm92ID0gKDEgLSBwYWRkaW5nICogMiAvIHN0YXRlLmhlaWdodCkgKiBjYW1lcmEuZm92O1xuICAgICAgICB2YXIgZml0SGVpZ2h0RGlzdGFuY2UgPSBtYXhCb3hTaWRlIC8gTWF0aC5hdGFuKHBhZGRlZEZvdiAqIE1hdGguUEkgLyAxODApO1xuICAgICAgICB2YXIgZml0V2lkdGhEaXN0YW5jZSA9IGZpdEhlaWdodERpc3RhbmNlIC8gY2FtZXJhLmFzcGVjdDtcbiAgICAgICAgdmFyIGRpc3RhbmNlID0gTWF0aC5tYXgoZml0SGVpZ2h0RGlzdGFuY2UsIGZpdFdpZHRoRGlzdGFuY2UpO1xuICAgICAgICBpZiAoZGlzdGFuY2UgPiAwKSB7XG4gICAgICAgICAgdmFyIG5ld0NhbWVyYVBvc2l0aW9uID0gY2VudGVyLmNsb25lKCkuc3ViKGNhbWVyYS5wb3NpdGlvbikubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoLWRpc3RhbmNlKTtcbiAgICAgICAgICB0aGlzLmNhbWVyYVBvc2l0aW9uKG5ld0NhbWVyYVBvc2l0aW9uLCBjZW50ZXIsIHRyYW5zaXRpb25EdXJhdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH0sXG4gICAgZ2V0QmJveDogZnVuY3Rpb24gZ2V0QmJveChzdGF0ZSkge1xuICAgICAgdmFyIG9iakZpbHRlciA9IGFyZ3VtZW50cy5sZW5ndGggPiAxICYmIGFyZ3VtZW50c1sxXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzFdIDogZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH07XG4gICAgICB2YXIgYm94ID0gbmV3IHRocmVlLkJveDMobmV3IHRocmVlLlZlY3RvcjMoMCwgMCwgMCksIG5ldyB0aHJlZS5WZWN0b3IzKDAsIDAsIDApKTtcbiAgICAgIHZhciBvYmpzID0gc3RhdGUub2JqZWN0cy5maWx0ZXIob2JqRmlsdGVyKTtcbiAgICAgIGlmICghb2Jqcy5sZW5ndGgpIHJldHVybiBudWxsO1xuICAgICAgb2Jqcy5mb3JFYWNoKGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgcmV0dXJuIGJveC5leHBhbmRCeU9iamVjdChvYmopO1xuICAgICAgfSk7XG5cbiAgICAgIC8vIGV4dHJhY3QgZ2xvYmFsIHgseSx6IG1pbi9tYXhcbiAgICAgIHJldHVybiBPYmplY3QuYXNzaWduLmFwcGx5KE9iamVjdCwgX3RvQ29uc3VtYWJsZUFycmF5KFsneCcsICd5JywgJ3onXS5tYXAoZnVuY3Rpb24gKGMpIHtcbiAgICAgICAgcmV0dXJuIF9kZWZpbmVQcm9wZXJ0eSh7fSwgYywgW2JveC5taW5bY10sIGJveC5tYXhbY11dKTtcbiAgICAgIH0pKSk7XG4gICAgfSxcbiAgICBnZXRTY3JlZW5Db29yZHM6IGZ1bmN0aW9uIGdldFNjcmVlbkNvb3JkcyhzdGF0ZSwgeCwgeSwgeikge1xuICAgICAgdmFyIHZlYyA9IG5ldyB0aHJlZS5WZWN0b3IzKHgsIHksIHopO1xuICAgICAgdmVjLnByb2plY3QodGhpcy5jYW1lcmEoKSk7IC8vIHByb2plY3QgdG8gdGhlIGNhbWVyYSBwbGFuZVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLy8gYWxpZ24gcmVsYXRpdmUgcG9zIHRvIGNhbnZhcyBkaW1lbnNpb25zXG4gICAgICAgIHg6ICh2ZWMueCArIDEpICogc3RhdGUud2lkdGggLyAyLFxuICAgICAgICB5OiAtKHZlYy55IC0gMSkgKiBzdGF0ZS5oZWlnaHQgLyAyXG4gICAgICB9O1xuICAgIH0sXG4gICAgZ2V0U2NlbmVDb29yZHM6IGZ1bmN0aW9uIGdldFNjZW5lQ29vcmRzKHN0YXRlLCBzY3JlZW5YLCBzY3JlZW5ZKSB7XG4gICAgICB2YXIgZGlzdGFuY2UgPSBhcmd1bWVudHMubGVuZ3RoID4gMyAmJiBhcmd1bWVudHNbM10gIT09IHVuZGVmaW5lZCA/IGFyZ3VtZW50c1szXSA6IDA7XG4gICAgICB2YXIgcmVsQ29vcmRzID0gbmV3IHRocmVlLlZlY3RvcjIoc2NyZWVuWCAvIHN0YXRlLndpZHRoICogMiAtIDEsIC0oc2NyZWVuWSAvIHN0YXRlLmhlaWdodCkgKiAyICsgMSk7XG4gICAgICB2YXIgcmF5Y2FzdGVyID0gbmV3IHRocmVlLlJheWNhc3RlcigpO1xuICAgICAgcmF5Y2FzdGVyLnNldEZyb21DYW1lcmEocmVsQ29vcmRzLCBzdGF0ZS5jYW1lcmEpO1xuICAgICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oe30sIHJheWNhc3Rlci5yYXkuYXQoZGlzdGFuY2UsIG5ldyB0aHJlZS5WZWN0b3IzKCkpKTtcbiAgICB9LFxuICAgIGludGVyc2VjdGluZ09iamVjdHM6IGZ1bmN0aW9uIGludGVyc2VjdGluZ09iamVjdHMoc3RhdGUsIHgsIHkpIHtcbiAgICAgIHZhciByZWxDb29yZHMgPSBuZXcgdGhyZWUuVmVjdG9yMih4IC8gc3RhdGUud2lkdGggKiAyIC0gMSwgLSh5IC8gc3RhdGUuaGVpZ2h0KSAqIDIgKyAxKTtcbiAgICAgIHZhciByYXljYXN0ZXIgPSBuZXcgdGhyZWUuUmF5Y2FzdGVyKCk7XG4gICAgICByYXljYXN0ZXIucGFyYW1zLkxpbmUudGhyZXNob2xkID0gc3RhdGUubGluZUhvdmVyUHJlY2lzaW9uOyAvLyBzZXQgbGluZVByZWNpc2lvblxuICAgICAgcmF5Y2FzdGVyLnBhcmFtcy5Qb2ludHMudGhyZXNob2xkID0gc3RhdGUucG9pbnRzSG92ZXJQcmVjaXNpb247IC8vIHNldCBwb2ludHNQcmVjaXNpb25cbiAgICAgIHJheWNhc3Rlci5zZXRGcm9tQ2FtZXJhKHJlbENvb3Jkcywgc3RhdGUuY2FtZXJhKTtcbiAgICAgIHJldHVybiByYXljYXN0ZXIuaW50ZXJzZWN0T2JqZWN0cyhzdGF0ZS5vYmplY3RzLCB0cnVlKTtcbiAgICB9LFxuICAgIHJlbmRlcmVyOiBmdW5jdGlvbiByZW5kZXJlcihzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlLnJlbmRlcmVyO1xuICAgIH0sXG4gICAgc2NlbmU6IGZ1bmN0aW9uIHNjZW5lKHN0YXRlKSB7XG4gICAgICByZXR1cm4gc3RhdGUuc2NlbmU7XG4gICAgfSxcbiAgICBjYW1lcmE6IGZ1bmN0aW9uIGNhbWVyYShzdGF0ZSkge1xuICAgICAgcmV0dXJuIHN0YXRlLmNhbWVyYTtcbiAgICB9LFxuICAgIHBvc3RQcm9jZXNzaW5nQ29tcG9zZXI6IGZ1bmN0aW9uIHBvc3RQcm9jZXNzaW5nQ29tcG9zZXIoc3RhdGUpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5wb3N0UHJvY2Vzc2luZ0NvbXBvc2VyO1xuICAgIH0sXG4gICAgY29udHJvbHM6IGZ1bmN0aW9uIGNvbnRyb2xzKHN0YXRlKSB7XG4gICAgICByZXR1cm4gc3RhdGUuY29udHJvbHM7XG4gICAgfSxcbiAgICB0YkNvbnRyb2xzOiBmdW5jdGlvbiB0YkNvbnRyb2xzKHN0YXRlKSB7XG4gICAgICByZXR1cm4gc3RhdGUuY29udHJvbHM7XG4gICAgfSAvLyB0byBiZSBkZXByZWNhdGVkXG4gIH0sXG4gIHN0YXRlSW5pdDogZnVuY3Rpb24gc3RhdGVJbml0KCkge1xuICAgIHJldHVybiB7XG4gICAgICBzY2VuZTogbmV3IHRocmVlLlNjZW5lKCksXG4gICAgICBjYW1lcmE6IG5ldyB0aHJlZS5QZXJzcGVjdGl2ZUNhbWVyYSgpLFxuICAgICAgY2xvY2s6IG5ldyB0aHJlZS5DbG9jaygpLFxuICAgICAgdHdlZW5Hcm91cDogbmV3IEdyb3VwKCksXG4gICAgICBsYXN0UmF5Y2FzdGVyQ2hlY2s6IDBcbiAgICB9O1xuICB9LFxuICBpbml0OiBmdW5jdGlvbiBpbml0KGRvbU5vZGUsIHN0YXRlKSB7XG4gICAgdmFyIF9yZWY0ID0gYXJndW1lbnRzLmxlbmd0aCA+IDIgJiYgYXJndW1lbnRzWzJdICE9PSB1bmRlZmluZWQgPyBhcmd1bWVudHNbMl0gOiB7fSxcbiAgICAgIF9yZWY0JGNvbnRyb2xUeXBlID0gX3JlZjQuY29udHJvbFR5cGUsXG4gICAgICBjb250cm9sVHlwZSA9IF9yZWY0JGNvbnRyb2xUeXBlID09PSB2b2lkIDAgPyAndHJhY2tiYWxsJyA6IF9yZWY0JGNvbnRyb2xUeXBlLFxuICAgICAgX3JlZjQkdXNlV2ViR1BVID0gX3JlZjQudXNlV2ViR1BVLFxuICAgICAgdXNlV2ViR1BVID0gX3JlZjQkdXNlV2ViR1BVID09PSB2b2lkIDAgPyBmYWxzZSA6IF9yZWY0JHVzZVdlYkdQVSxcbiAgICAgIF9yZWY0JHJlbmRlcmVyQ29uZmlnID0gX3JlZjQucmVuZGVyZXJDb25maWcsXG4gICAgICByZW5kZXJlckNvbmZpZyA9IF9yZWY0JHJlbmRlcmVyQ29uZmlnID09PSB2b2lkIDAgPyB7fSA6IF9yZWY0JHJlbmRlcmVyQ29uZmlnLFxuICAgICAgX3JlZjQkZXh0cmFSZW5kZXJlcnMgPSBfcmVmNC5leHRyYVJlbmRlcmVycyxcbiAgICAgIGV4dHJhUmVuZGVyZXJzID0gX3JlZjQkZXh0cmFSZW5kZXJlcnMgPT09IHZvaWQgMCA/IFtdIDogX3JlZjQkZXh0cmFSZW5kZXJlcnMsXG4gICAgICBfcmVmNCR3YWl0Rm9yTG9hZENvbXAgPSBfcmVmNC53YWl0Rm9yTG9hZENvbXBsZXRlLFxuICAgICAgd2FpdEZvckxvYWRDb21wbGV0ZSA9IF9yZWY0JHdhaXRGb3JMb2FkQ29tcCA9PT0gdm9pZCAwID8gdHJ1ZSA6IF9yZWY0JHdhaXRGb3JMb2FkQ29tcDtcbiAgICAvLyBXaXBlIERPTVxuICAgIGRvbU5vZGUuaW5uZXJIVE1MID0gJyc7XG5cbiAgICAvLyBBZGQgcmVsYXRpdmUgY29udGFpbmVyXG4gICAgZG9tTm9kZS5hcHBlbmRDaGlsZChzdGF0ZS5jb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKSk7XG4gICAgc3RhdGUuY29udGFpbmVyLmNsYXNzTmFtZSA9ICdzY2VuZS1jb250YWluZXInO1xuICAgIHN0YXRlLmNvbnRhaW5lci5zdHlsZS5wb3NpdGlvbiA9ICdyZWxhdGl2ZSc7XG5cbiAgICAvLyBBZGQgbmF2IGluZm8gc2VjdGlvblxuICAgIHN0YXRlLmNvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0ZS5uYXZJbmZvID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JykpO1xuICAgIHN0YXRlLm5hdkluZm8uY2xhc3NOYW1lID0gJ3NjZW5lLW5hdi1pbmZvJztcbiAgICBzdGF0ZS5uYXZJbmZvLnRleHRDb250ZW50ID0ge1xuICAgICAgb3JiaXQ6ICdMZWZ0LWNsaWNrOiByb3RhdGUsIE1vdXNlLXdoZWVsL21pZGRsZS1jbGljazogem9vbSwgUmlnaHQtY2xpY2s6IHBhbicsXG4gICAgICB0cmFja2JhbGw6ICdMZWZ0LWNsaWNrOiByb3RhdGUsIE1vdXNlLXdoZWVsL21pZGRsZS1jbGljazogem9vbSwgUmlnaHQtY2xpY2s6IHBhbicsXG4gICAgICBmbHk6ICdXQVNEOiBtb3ZlLCBSfEY6IHVwIHwgZG93biwgUXxFOiByb2xsLCB1cHxkb3duOiBwaXRjaCwgbGVmdHxyaWdodDogeWF3J1xuICAgIH1bY29udHJvbFR5cGVdIHx8ICcnO1xuICAgIHN0YXRlLm5hdkluZm8uc3R5bGUuZGlzcGxheSA9IHN0YXRlLnNob3dOYXZJbmZvID8gbnVsbCA6ICdub25lJztcblxuICAgIC8vIFNldHVwIHRvb2x0aXBcbiAgICBzdGF0ZS50b29sdGlwID0gbmV3IFRvb2x0aXAoc3RhdGUuY29udGFpbmVyKTtcblxuICAgIC8vIENhcHR1cmUgcG9pbnRlciBjb29yZHMgb24gbW92ZSBvciB0b3VjaHN0YXJ0XG4gICAgc3RhdGUucG9pbnRlclBvcyA9IG5ldyB0aHJlZS5WZWN0b3IyKCk7XG4gICAgc3RhdGUucG9pbnRlclBvcy54ID0gLTI7IC8vIEluaXRpYWxpemUgb2ZmIGNhbnZhc1xuICAgIHN0YXRlLnBvaW50ZXJQb3MueSA9IC0yO1xuICAgIFsncG9pbnRlcm1vdmUnLCAncG9pbnRlcmRvd24nXS5mb3JFYWNoKGZ1bmN0aW9uIChldlR5cGUpIHtcbiAgICAgIHJldHVybiBzdGF0ZS5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihldlR5cGUsIGZ1bmN0aW9uIChldikge1xuICAgICAgICAvLyB0cmFjayBjbGljayBzdGF0ZVxuICAgICAgICBldlR5cGUgPT09ICdwb2ludGVyZG93bicgJiYgKHN0YXRlLmlzUG9pbnRlclByZXNzZWQgPSB0cnVlKTtcblxuICAgICAgICAvLyBkZXRlY3QgcG9pbnQgZHJhZ1xuICAgICAgICAhc3RhdGUuaXNQb2ludGVyRHJhZ2dpbmcgJiYgZXYudHlwZSA9PT0gJ3BvaW50ZXJtb3ZlJyAmJiAoZXYucHJlc3N1cmUgPiAwIHx8IHN0YXRlLmlzUG9pbnRlclByZXNzZWQpIC8vIGV2LnByZXNzdXJlIGFsd2F5cyAwIG9uIFNhZmFyaSwgc28gd2UgdXNlZCB0aGUgaXNQb2ludGVyUHJlc3NlZCB0cmFja2VyXG4gICAgICAgICYmIChldi5wb2ludGVyVHlwZSA9PT0gJ21vdXNlJyB8fCBldi5tb3ZlbWVudFggPT09IHVuZGVmaW5lZCB8fCBbZXYubW92ZW1lbnRYLCBldi5tb3ZlbWVudFldLnNvbWUoZnVuY3Rpb24gKG0pIHtcbiAgICAgICAgICByZXR1cm4gTWF0aC5hYnMobSkgPiAxO1xuICAgICAgICB9KSkgLy8gcmVsYXggZHJhZyB0cmlnZ2VyIHNlbnNpdGl2aXR5IG9uIG5vbi1tb3VzZSAodG91Y2gvcGVuKSBldmVudHNcbiAgICAgICAgJiYgKHN0YXRlLmlzUG9pbnRlckRyYWdnaW5nID0gdHJ1ZSk7XG4gICAgICAgIGlmIChzdGF0ZS5lbmFibGVQb2ludGVySW50ZXJhY3Rpb24pIHtcbiAgICAgICAgICAvLyB1cGRhdGUgdGhlIHBvaW50ZXIgcG9zXG4gICAgICAgICAgdmFyIG9mZnNldCA9IGdldE9mZnNldChzdGF0ZS5jb250YWluZXIpO1xuICAgICAgICAgIHN0YXRlLnBvaW50ZXJQb3MueCA9IGV2LnBhZ2VYIC0gb2Zmc2V0LmxlZnQ7XG4gICAgICAgICAgc3RhdGUucG9pbnRlclBvcy55ID0gZXYucGFnZVkgLSBvZmZzZXQudG9wO1xuICAgICAgICB9XG4gICAgICAgIGZ1bmN0aW9uIGdldE9mZnNldChlbCkge1xuICAgICAgICAgIHZhciByZWN0ID0gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksXG4gICAgICAgICAgICBzY3JvbGxMZWZ0ID0gd2luZG93LnBhZ2VYT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0LFxuICAgICAgICAgICAgc2Nyb2xsVG9wID0gd2luZG93LnBhZ2VZT2Zmc2V0IHx8IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3A7XG4gICAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICAgIHRvcDogcmVjdC50b3AgKyBzY3JvbGxUb3AsXG4gICAgICAgICAgICBsZWZ0OiByZWN0LmxlZnQgKyBzY3JvbGxMZWZ0XG4gICAgICAgICAgfTtcbiAgICAgICAgfVxuICAgICAgfSwge1xuICAgICAgICBwYXNzaXZlOiB0cnVlXG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIC8vIEhhbmRsZSBjbGljayBldmVudHMgb24gb2Jqc1xuICAgIHN0YXRlLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCdwb2ludGVydXAnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgIGlmICghc3RhdGUuaXNQb2ludGVyUHJlc3NlZCkgcmV0dXJuOyAvLyBkb24ndCB0cmlnZ2VyIGNsaWNrIGV2ZW50cyBpZiBwb2ludGVyIGlzIG5vdCBwcmVzc2VkIG9uIHRoZSBjYW52YXNcblxuICAgICAgc3RhdGUuaXNQb2ludGVyUHJlc3NlZCA9IGZhbHNlO1xuICAgICAgaWYgKHN0YXRlLmlzUG9pbnRlckRyYWdnaW5nKSB7XG4gICAgICAgIHN0YXRlLmlzUG9pbnRlckRyYWdnaW5nID0gZmFsc2U7XG4gICAgICAgIGlmICghc3RhdGUuY2xpY2tBZnRlckRyYWcpIHJldHVybjsgLy8gZG9uJ3QgdHJpZ2dlciBvbkNsaWNrIGFmdGVyIHBvaW50ZXIgZHJhZyAoY2FtZXJhIG1vdGlvbiB2aWEgY29udHJvbHMpXG4gICAgICB9XG4gICAgICByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24gKCkge1xuICAgICAgICAvLyB0cmlnZ2VyIGNsaWNrIGV2ZW50cyBhc3luY2hyb25vdXNseSwgdG8gYWxsb3cgaG92ZXJPYmogdG8gYmUgc2V0IChvbiBmcmFtZSlcbiAgICAgICAgaWYgKGV2LmJ1dHRvbiA9PT0gMCkge1xuICAgICAgICAgIC8vIGxlZnQtY2xpY2tcbiAgICAgICAgICBzdGF0ZS5vbkNsaWNrKHN0YXRlLmhvdmVyT2JqIHx8IG51bGwsIGV2LCBzdGF0ZS5pbnRlcnNlY3Rpb24pOyAvLyB0cmlnZ2VyIGJhY2tncm91bmQgY2xpY2tzIHdpdGggbnVsbFxuICAgICAgICB9XG4gICAgICAgIGlmIChldi5idXR0b24gPT09IDIgJiYgc3RhdGUub25SaWdodENsaWNrKSB7XG4gICAgICAgICAgLy8gcmlnaHQtY2xpY2tcbiAgICAgICAgICBzdGF0ZS5vblJpZ2h0Q2xpY2soc3RhdGUuaG92ZXJPYmogfHwgbnVsbCwgZXYsIHN0YXRlLmludGVyc2VjdGlvbik7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sIHtcbiAgICAgIHBhc3NpdmU6IHRydWUsXG4gICAgICBjYXB0dXJlOiB0cnVlXG4gICAgfSk7IC8vIHVzZSBjYXB0dXJlIHBoYXNlIHRvIHByZXZlbnQgcHJvcGFnYXRpb24gYmxvY2tpbmcgZnJvbSBjb250cm9scyAoc3BlY2lmaWNhbGx5IGZvciBmbHkpXG5cbiAgICBzdGF0ZS5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcignY29udGV4dG1lbnUnLCBmdW5jdGlvbiAoZXYpIHtcbiAgICAgIGlmIChzdGF0ZS5vblJpZ2h0Q2xpY2spIGV2LnByZXZlbnREZWZhdWx0KCk7IC8vIHByZXZlbnQgZGVmYXVsdCBjb250ZXh0bWVudSBiZWhhdmlvciBhbmQgYWxsb3cgcG9pbnRlcnVwIHRvIGZpcmUgaW5zdGVhZFxuICAgIH0pO1xuXG4gICAgLy8gU2V0dXAgcmVuZGVyZXIsIGNhbWVyYSBhbmQgY29udHJvbHNcbiAgICBzdGF0ZS5yZW5kZXJlciA9IG5ldyAodXNlV2ViR1BVID8gV2ViR1BVUmVuZGVyZXIgOiB0aHJlZS5XZWJHTFJlbmRlcmVyKShPYmplY3QuYXNzaWduKHtcbiAgICAgIGFudGlhbGlhczogdHJ1ZSxcbiAgICAgIGFscGhhOiB0cnVlXG4gICAgfSwgcmVuZGVyZXJDb25maWcpKTtcbiAgICBzdGF0ZS5yZW5kZXJlci5zZXRQaXhlbFJhdGlvKE1hdGgubWluKDIsIHdpbmRvdy5kZXZpY2VQaXhlbFJhdGlvKSk7IC8vIGNsYW1wIGRldmljZSBwaXhlbCByYXRpb1xuICAgIHN0YXRlLmNvbnRhaW5lci5hcHBlbmRDaGlsZChzdGF0ZS5yZW5kZXJlci5kb21FbGVtZW50KTtcblxuICAgIC8vIFNldHVwIGV4dHJhIHJlbmRlcmVyc1xuICAgIHN0YXRlLmV4dHJhUmVuZGVyZXJzID0gZXh0cmFSZW5kZXJlcnM7XG4gICAgc3RhdGUuZXh0cmFSZW5kZXJlcnMuZm9yRWFjaChmdW5jdGlvbiAocikge1xuICAgICAgLy8gb3ZlcmxheSB0aGVtIG9uIHRvcCBvZiBtYWluIHJlbmRlcmVyXG4gICAgICByLmRvbUVsZW1lbnQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgci5kb21FbGVtZW50LnN0eWxlLnRvcCA9ICcwcHgnO1xuICAgICAgci5kb21FbGVtZW50LnN0eWxlLnBvaW50ZXJFdmVudHMgPSAnbm9uZSc7XG4gICAgICBzdGF0ZS5jb250YWluZXIuYXBwZW5kQ2hpbGQoci5kb21FbGVtZW50KTtcbiAgICB9KTtcblxuICAgIC8vIGNvbmZpZ3VyZSBwb3N0LXByb2Nlc3NpbmcgY29tcG9zZXJcbiAgICBzdGF0ZS5wb3N0UHJvY2Vzc2luZ0NvbXBvc2VyID0gbmV3IEVmZmVjdENvbXBvc2VyKHN0YXRlLnJlbmRlcmVyKTtcbiAgICBzdGF0ZS5wb3N0UHJvY2Vzc2luZ0NvbXBvc2VyLmFkZFBhc3MobmV3IFJlbmRlclBhc3Moc3RhdGUuc2NlbmUsIHN0YXRlLmNhbWVyYSkpOyAvLyByZW5kZXIgc2NlbmUgYXMgZmlyc3QgcGFzc1xuXG4gICAgLy8gY29uZmlndXJlIGNvbnRyb2xzXG4gICAgc3RhdGUuY29udHJvbHMgPSBuZXcge1xuICAgICAgdHJhY2tiYWxsOiBUcmFja2JhbGxDb250cm9scyxcbiAgICAgIG9yYml0OiBPcmJpdENvbnRyb2xzLFxuICAgICAgZmx5OiBGbHlDb250cm9sc1xuICAgIH1bY29udHJvbFR5cGVdKHN0YXRlLmNhbWVyYSwgc3RhdGUucmVuZGVyZXIuZG9tRWxlbWVudCk7XG4gICAgaWYgKGNvbnRyb2xUeXBlID09PSAnZmx5Jykge1xuICAgICAgc3RhdGUuY29udHJvbHMubW92ZW1lbnRTcGVlZCA9IDMwMDtcbiAgICAgIHN0YXRlLmNvbnRyb2xzLnJvbGxTcGVlZCA9IE1hdGguUEkgLyA2O1xuICAgICAgc3RhdGUuY29udHJvbHMuZHJhZ1RvTG9vayA9IHRydWU7XG4gICAgfVxuICAgIGlmIChjb250cm9sVHlwZSA9PT0gJ3RyYWNrYmFsbCcgfHwgY29udHJvbFR5cGUgPT09ICdvcmJpdCcpIHtcbiAgICAgIHN0YXRlLmNvbnRyb2xzLm1pbkRpc3RhbmNlID0gMC4xO1xuICAgICAgc3RhdGUuY29udHJvbHMubWF4RGlzdGFuY2UgPSBzdGF0ZS5za3lSYWRpdXM7XG4gICAgICBzdGF0ZS5jb250cm9scy5hZGRFdmVudExpc3RlbmVyKCdzdGFydCcsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgc3RhdGUuY29udHJvbHNFbmdhZ2VkID0gdHJ1ZTtcbiAgICAgIH0pO1xuICAgICAgc3RhdGUuY29udHJvbHMuYWRkRXZlbnRMaXN0ZW5lcignY2hhbmdlJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoc3RhdGUuY29udHJvbHNFbmdhZ2VkKSB7XG4gICAgICAgICAgc3RhdGUuY29udHJvbHNEcmFnZ2luZyA9IHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgc3RhdGUuY29udHJvbHMuYWRkRXZlbnRMaXN0ZW5lcignZW5kJywgZnVuY3Rpb24gKCkge1xuICAgICAgICBzdGF0ZS5jb250cm9sc0VuZ2FnZWQgPSBmYWxzZTtcbiAgICAgICAgc3RhdGUuY29udHJvbHNEcmFnZ2luZyA9IGZhbHNlO1xuICAgICAgfSk7XG4gICAgfVxuICAgIFtzdGF0ZS5yZW5kZXJlciwgc3RhdGUucG9zdFByb2Nlc3NpbmdDb21wb3Nlcl0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShzdGF0ZS5leHRyYVJlbmRlcmVycykpLmZvckVhY2goZnVuY3Rpb24gKHIpIHtcbiAgICAgIHJldHVybiByLnNldFNpemUoc3RhdGUud2lkdGgsIHN0YXRlLmhlaWdodCk7XG4gICAgfSk7XG4gICAgc3RhdGUuY2FtZXJhLmFzcGVjdCA9IHN0YXRlLndpZHRoIC8gc3RhdGUuaGVpZ2h0O1xuICAgIHN0YXRlLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7XG4gICAgc3RhdGUuY2FtZXJhLnBvc2l0aW9uLnogPSAxMDAwO1xuXG4gICAgLy8gYWRkIHNreVxuICAgIHN0YXRlLnNjZW5lLmFkZChzdGF0ZS5za3lzcGhlcmUgPSBuZXcgdGhyZWUuTWVzaCgpKTtcbiAgICBzdGF0ZS5za3lzcGhlcmUudmlzaWJsZSA9IGZhbHNlO1xuICAgIHN0YXRlLmxvYWRDb21wbGV0ZSA9IHN0YXRlLnNjZW5lLnZpc2libGUgPSAhd2FpdEZvckxvYWRDb21wbGV0ZTtcbiAgICB3aW5kb3cuc2NlbmUgPSBzdGF0ZS5zY2VuZTtcbiAgfSxcbiAgdXBkYXRlOiBmdW5jdGlvbiB1cGRhdGUoc3RhdGUsIGNoYW5nZWRQcm9wcykge1xuICAgIC8vIHJlc2l6ZSBjYW52YXNcbiAgICBpZiAoc3RhdGUud2lkdGggJiYgc3RhdGUuaGVpZ2h0ICYmIChjaGFuZ2VkUHJvcHMuaGFzT3duUHJvcGVydHkoJ3dpZHRoJykgfHwgY2hhbmdlZFByb3BzLmhhc093blByb3BlcnR5KCdoZWlnaHQnKSkpIHtcbiAgICAgIHZhciBfc3RhdGUkY2FtZXJhO1xuICAgICAgdmFyIHcgPSBzdGF0ZS53aWR0aDtcbiAgICAgIHZhciBoID0gc3RhdGUuaGVpZ2h0O1xuICAgICAgc3RhdGUuY29udGFpbmVyLnN0eWxlLndpZHRoID0gXCJcIi5jb25jYXQodywgXCJweFwiKTtcbiAgICAgIHN0YXRlLmNvbnRhaW5lci5zdHlsZS5oZWlnaHQgPSBcIlwiLmNvbmNhdChoLCBcInB4XCIpO1xuICAgICAgW3N0YXRlLnJlbmRlcmVyLCBzdGF0ZS5wb3N0UHJvY2Vzc2luZ0NvbXBvc2VyXS5jb25jYXQoX3RvQ29uc3VtYWJsZUFycmF5KHN0YXRlLmV4dHJhUmVuZGVyZXJzKSkuZm9yRWFjaChmdW5jdGlvbiAocikge1xuICAgICAgICByZXR1cm4gci5zZXRTaXplKHcsIGgpO1xuICAgICAgfSk7XG4gICAgICBzdGF0ZS5jYW1lcmEuYXNwZWN0ID0gdyAvIGg7XG4gICAgICB2YXIgbyA9IHN0YXRlLnZpZXdPZmZzZXQuc2xpY2UoMCwgMik7XG4gICAgICBvLnNvbWUoZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9KSAmJiAoX3N0YXRlJGNhbWVyYSA9IHN0YXRlLmNhbWVyYSkuc2V0Vmlld09mZnNldC5hcHBseShfc3RhdGUkY2FtZXJhLCBbdywgaF0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShvKSwgW3csIGhdKSk7XG4gICAgICBzdGF0ZS5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlZFByb3BzLmhhc093blByb3BlcnR5KCd2aWV3T2Zmc2V0JykpIHtcbiAgICAgIHZhciBfc3RhdGUkY2FtZXJhMjtcbiAgICAgIHZhciBfdyA9IHN0YXRlLndpZHRoO1xuICAgICAgdmFyIF9oID0gc3RhdGUuaGVpZ2h0O1xuICAgICAgdmFyIF9vID0gc3RhdGUudmlld09mZnNldC5zbGljZSgwLCAyKTtcbiAgICAgIF9vLnNvbWUoZnVuY3Rpb24gKG4pIHtcbiAgICAgICAgcmV0dXJuIG47XG4gICAgICB9KSA/IChfc3RhdGUkY2FtZXJhMiA9IHN0YXRlLmNhbWVyYSkuc2V0Vmlld09mZnNldC5hcHBseShfc3RhdGUkY2FtZXJhMiwgW193LCBfaF0uY29uY2F0KF90b0NvbnN1bWFibGVBcnJheShfbyksIFtfdywgX2hdKSkgOiBzdGF0ZS5jYW1lcmEuY2xlYXJWaWV3T2Zmc2V0KCk7XG4gICAgfVxuICAgIGlmIChjaGFuZ2VkUHJvcHMuaGFzT3duUHJvcGVydHkoJ3NreVJhZGl1cycpICYmIHN0YXRlLnNreVJhZGl1cykge1xuICAgICAgc3RhdGUuY29udHJvbHMuaGFzT3duUHJvcGVydHkoJ21heERpc3RhbmNlJykgJiYgY2hhbmdlZFByb3BzLnNreVJhZGl1cyAmJiAoc3RhdGUuY29udHJvbHMubWF4RGlzdGFuY2UgPSBNYXRoLm1pbihzdGF0ZS5jb250cm9scy5tYXhEaXN0YW5jZSwgc3RhdGUuc2t5UmFkaXVzKSk7XG4gICAgICBzdGF0ZS5jYW1lcmEuZmFyID0gc3RhdGUuc2t5UmFkaXVzICogMi41O1xuICAgICAgc3RhdGUuY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTtcbiAgICAgIHN0YXRlLnNreXNwaGVyZS5nZW9tZXRyeSA9IG5ldyB0aHJlZS5TcGhlcmVHZW9tZXRyeShzdGF0ZS5za3lSYWRpdXMpO1xuICAgIH1cbiAgICBpZiAoY2hhbmdlZFByb3BzLmhhc093blByb3BlcnR5KCdiYWNrZ3JvdW5kQ29sb3InKSkge1xuICAgICAgdmFyIGFscGhhID0gcGFyc2VUb1JnYihzdGF0ZS5iYWNrZ3JvdW5kQ29sb3IpLmFscGhhO1xuICAgICAgaWYgKGFscGhhID09PSB1bmRlZmluZWQpIGFscGhhID0gMTtcbiAgICAgIHN0YXRlLnJlbmRlcmVyLnNldENsZWFyQ29sb3IobmV3IHRocmVlLkNvbG9yKG9wYWNpZnkoMSwgc3RhdGUuYmFja2dyb3VuZENvbG9yKSksIGFscGhhKTtcbiAgICB9XG4gICAgaWYgKGNoYW5nZWRQcm9wcy5oYXNPd25Qcm9wZXJ0eSgnYmFja2dyb3VuZEltYWdlVXJsJykpIHtcbiAgICAgIGlmICghc3RhdGUuYmFja2dyb3VuZEltYWdlVXJsKSB7XG4gICAgICAgIHN0YXRlLnNreXNwaGVyZS52aXNpYmxlID0gZmFsc2U7XG4gICAgICAgIHN0YXRlLnNreXNwaGVyZS5tYXRlcmlhbC5tYXAgPSBudWxsO1xuICAgICAgICAhc3RhdGUubG9hZENvbXBsZXRlICYmIGZpbmlzaExvYWQoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ldyB0aHJlZS5UZXh0dXJlTG9hZGVyKCkubG9hZChzdGF0ZS5iYWNrZ3JvdW5kSW1hZ2VVcmwsIGZ1bmN0aW9uICh0ZXh0dXJlKSB7XG4gICAgICAgICAgdGV4dHVyZS5jb2xvclNwYWNlID0gdGhyZWUuU1JHQkNvbG9yU3BhY2U7XG4gICAgICAgICAgc3RhdGUuc2t5c3BoZXJlLm1hdGVyaWFsID0gbmV3IHRocmVlLk1lc2hCYXNpY01hdGVyaWFsKHtcbiAgICAgICAgICAgIG1hcDogdGV4dHVyZSxcbiAgICAgICAgICAgIHNpZGU6IHRocmVlLkJhY2tTaWRlXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3RhdGUuc2t5c3BoZXJlLnZpc2libGUgPSB0cnVlO1xuXG4gICAgICAgICAgLy8gdHJpZ2dlcmVkIHdoZW4gYmFja2dyb3VuZCBpbWFnZSBmaW5pc2hlcyBsb2FkaW5nIChhc3luY2hyb25vdXNseSB0byBhbGxvdyAxIGZyYW1lIHRvIGxvYWQgdGV4dHVyZSlcbiAgICAgICAgICBzdGF0ZS5vbkJhY2tncm91bmRJbWFnZUxvYWRlZCAmJiBzZXRUaW1lb3V0KHN0YXRlLm9uQmFja2dyb3VuZEltYWdlTG9hZGVkKTtcbiAgICAgICAgICAhc3RhdGUubG9hZENvbXBsZXRlICYmIGZpbmlzaExvYWQoKTtcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfVxuICAgIGNoYW5nZWRQcm9wcy5oYXNPd25Qcm9wZXJ0eSgnc2hvd05hdkluZm8nKSAmJiAoc3RhdGUubmF2SW5mby5zdHlsZS5kaXNwbGF5ID0gc3RhdGUuc2hvd05hdkluZm8gPyBudWxsIDogJ25vbmUnKTtcbiAgICBpZiAoY2hhbmdlZFByb3BzLmhhc093blByb3BlcnR5KCdsaWdodHMnKSkge1xuICAgICAgKGNoYW5nZWRQcm9wcy5saWdodHMgfHwgW10pLmZvckVhY2goZnVuY3Rpb24gKGxpZ2h0KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5zY2VuZS5yZW1vdmUobGlnaHQpO1xuICAgICAgfSk7IC8vIENsZWFyIHRoZSBwbGFjZVxuICAgICAgc3RhdGUubGlnaHRzLmZvckVhY2goZnVuY3Rpb24gKGxpZ2h0KSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5zY2VuZS5hZGQobGlnaHQpO1xuICAgICAgfSk7IC8vIEFkZCB0byBzY2VuZVxuICAgIH1cbiAgICBpZiAoY2hhbmdlZFByb3BzLmhhc093blByb3BlcnR5KCdvYmplY3RzJykpIHtcbiAgICAgIChjaGFuZ2VkUHJvcHMub2JqZWN0cyB8fCBbXSkuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5zY2VuZS5yZW1vdmUob2JqKTtcbiAgICAgIH0pOyAvLyBDbGVhciB0aGUgcGxhY2VcbiAgICAgIHN0YXRlLm9iamVjdHMuZm9yRWFjaChmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgIHJldHVybiBzdGF0ZS5zY2VuZS5hZGQob2JqKTtcbiAgICAgIH0pOyAvLyBBZGQgdG8gc2NlbmVcbiAgICB9XG5cbiAgICAvL1xuXG4gICAgZnVuY3Rpb24gZmluaXNoTG9hZCgpIHtcbiAgICAgIHN0YXRlLmxvYWRDb21wbGV0ZSA9IHN0YXRlLnNjZW5lLnZpc2libGUgPSB0cnVlO1xuICAgIH1cbiAgfVxufSk7XG5cbmV4cG9ydCB7IHRocmVlUmVuZGVyT2JqZWN0cyBhcyBkZWZhdWx0IH07XG4iXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbMF0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(ssr)/./node_modules/three-render-objects/dist/three-render-objects.mjs\n");

/***/ })

};
;