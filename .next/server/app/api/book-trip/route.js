(()=>{var t={};t.id=687,t.ids=[173,687,841],t.modules={846:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:t=>{"use strict";t.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:t=>{"use strict";t.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:t=>{"use strict";t.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9646:t=>{"use strict";t.exports=require("child_process")},5511:t=>{"use strict";t.exports=require("crypto")},4735:t=>{"use strict";t.exports=require("events")},1630:t=>{"use strict";t.exports=require("http")},5591:t=>{"use strict";t.exports=require("https")},8354:t=>{"use strict";t.exports=require("util")},6:(t,e,r)=>{"use strict";r.r(e),r.d(e,{patchFetch:()=>k,routeModule:()=>m,serverHooks:()=>M,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>b});var o={};r.r(o),r.d(o,{POST:()=>p});var a=r(2706),n=r(8203),s=r(5994),i=r(9187),u=r(9841),l=r(5173);async function p(t){try{let{tripPlan:e,userDetails:r,paymentMethod:o,context:a}=await t.json();if(!e)return i.NextResponse.json({success:!1,message:"Missing required trip plan information"},{status:400});let n=r||{name:"Guest User",email:"guest@example.com",phone:"+1234567890",passengers:[{firstName:"Guest",lastName:"User",dateOfBirth:"1990-01-01"}]};if(!e.transport||!e.hotel)return i.NextResponse.json({success:!1,message:"Incomplete trip plan. Please ensure flight and hotel are selected."},{status:400});e.groupSize||(e.groupSize=n.passengers?.length||1);let s=`TRIP-${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,p=[];e.transport&&("flight"===e.transportType?p.push(d(e.transport,r,e.groupSize)):"train"===e.transportType?p.push((0,u.O)(e.transport,r,e.groupSize)):"bus"===e.transportType&&p.push((0,l.i)(e.transport,r,e.groupSize))),e.returnTrip&&e.returnTransport&&("flight"===e.transportType?p.push(d(e.returnTransport,r,e.groupSize,!0)):"train"===e.transportType?p.push((0,u.O)(e.returnTransport,r,e.groupSize,!0)):"bus"===e.transportType&&p.push((0,l.i)(e.returnTransport,r,e.groupSize,!0))),e.hotel&&p.push(c(e.hotel,r,e.groupSize)),e.cabToStation&&p.push(h(e.cabToStation,r,"departure")),e.cabToHotel&&p.push(h(e.cabToHotel,r,"arrival"));let m=await Promise.allSettled(p),f={cabBookings:[]},b=e.total||((e.transport?.price||0)+(e.hotel?.price||0)+(e.cabToStation?.price||0)+(e.cabToHotel?.price||0)+(e.returnTransport?.price||0))*(e.groupSize||1),M=!0;m.forEach((t,e)=>{if("fulfilled"===t.status){let e=t.value;b+=e.totalAmount||e.amount||0,"flight"===e.type?e.isReturn?f.returnFlightBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status}:f.flightBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status,isReturn:e.isReturn}:"train"===e.type?e.isReturn?f.returnTrainBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status}:f.trainBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status,isReturn:e.isReturn}:"bus"===e.type?e.isReturn?f.returnBusBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status}:f.busBooking={bookingId:e.bookingId,pnr:e.pnr,status:e.status,isReturn:e.isReturn}:"hotel"===e.type&&"confirmationCode"in e?f.hotelBooking={bookingId:e.bookingId,confirmationCode:e.confirmationCode,status:e.status}:"cab"===e.type&&"driverDetails"in e&&(f.cabBookings||(f.cabBookings=[]),f.cabBookings.push({bookingId:e.bookingId,driverDetails:e.driverDetails,status:e.status}))}else M=!1,console.error(`Booking ${e} failed:`,t.reason)});let k=await g(b,o);if(!k.success)return i.NextResponse.json({success:!1,message:`Payment failed: ${k.message}`,bookingId:s},{status:400});let w={success:M,bookingId:s,message:M?"Your trip has been successfully booked! Check your email for confirmation details.":"Some bookings were successful, but there were issues with others. Please check the details.",confirmationDetails:f,totalAmount:b,currency:"INR"};return i.NextResponse.json(w)}catch(t){return console.error("Booking API Error:",t),i.NextResponse.json({success:!1,message:t.message||"An unexpected error occurred during booking."},{status:500})}}async function d(t,e,r,o=!1){try{if(process.env.AVIATIONSTACK_API_KEY){if(console.log(`Attempting to book ${o?"return ":""}flight ${t.flightNumber} with real API credentials`),await new Promise(t=>setTimeout(t,1e3+2e3*Math.random())),!(Math.random()>.1))throw Error(`${o?"Return flight":"Flight"} booking failed - no seats available`);return{type:"flight",isReturn:o,bookingId:`FL-${o?"RET-":""}${Date.now()}`,pnr:`PNR${Math.random().toString(36).substring(2,8).toUpperCase()}`,status:"confirmed",amount:t.price*r}}if(console.log("No flight booking API key found, using simulation"),await new Promise(t=>setTimeout(t,1e3+2e3*Math.random())),!(Math.random()>.1))throw Error("Flight booking failed - no seats available");return{type:"flight",bookingId:`FL-${Date.now()}`,pnr:`PNR${Math.random().toString(36).substring(2,8).toUpperCase()}`,status:"confirmed",amount:t.price*r}}catch(t){throw console.error("Flight booking error:",t),t}}async function c(t,e,r){try{if(process.env.RAPIDAPI_KEY){if(console.log(`Attempting to book hotel ${t.name} with real API credentials`),await new Promise(t=>setTimeout(t,800+1500*Math.random())),!(Math.random()>.05))throw Error("Hotel booking failed - room not available");return{type:"hotel",bookingId:`HTL-${Date.now()}`,confirmationCode:`CONF${Math.random().toString(36).substring(2,8).toUpperCase()}`,status:"confirmed",amount:t.price*r}}if(console.log("No hotel booking API key found, using simulation"),await new Promise(t=>setTimeout(t,800+1500*Math.random())),!(Math.random()>.05))throw Error("Hotel booking failed - room not available");return{type:"hotel",bookingId:`HTL-${Date.now()}`,confirmationCode:`CONF${Math.random().toString(36).substring(2,8).toUpperCase()}`,status:"confirmed",amount:t.price*r}}catch(t){throw console.error("Hotel booking error:",t),t}}async function h(t,e,o){try{let{bookCab:o}=await r.e(935).then(r.bind(r,3935)),a=process.env.UBER_CLIENT_ID,n=process.env.UBER_CLIENT_SECRET;if(a&&n&&t&&t.id&&t.id.startsWith("UBER-")){console.log(`Attempting to book Uber cab with ID ${t.id} with real API credentials`);let r={lat:t.origin?.lat||0,lng:t.origin?.lng||0,name:t.origin?.name||"Unknown Origin"},a={lat:t.destination?.lat||0,lng:t.destination?.lng||0,name:t.destination?.name||"Unknown Destination"};try{let n=await o(t.id,r,a,e.passengers?.length||1,e);return{type:"cab",bookingId:n.bookingId,driverDetails:n.driverDetails,status:"confirmed",amount:n.fare||t.price}}catch(t){console.error("Real cab booking failed, falling back to simulation:",t)}}if(console.log("No cab booking API credentials found or real booking failed, using simulation"),await new Promise(t=>setTimeout(t,500+1e3*Math.random())),!(Math.random()>.15))throw Error("Cab booking failed - no drivers available");return{type:"cab",bookingId:`CAB-${Date.now()}`,driverDetails:{name:`Driver ${Math.floor(1e3*Math.random())}`,phone:`+91${Math.floor(9e9*Math.random())+1e9}`,vehicleNumber:`${["DL","MH","KA","TN"][Math.floor(4*Math.random())]}${Math.floor(100*Math.random())}${String.fromCharCode(65+Math.floor(26*Math.random()))}${Math.floor(1e4*Math.random())}`},status:"confirmed",amount:t.price}}catch(t){throw console.error("Cab booking error:",t),t}}async function g(t,e){try{let{stripe:o}=await Promise.all([r.e(184),r.e(854)]).then(r.bind(r,1854)),a=await o.paymentIntents.create({amount:Math.round(100*t),currency:"inr",payment_method:e.id,confirm:!0,return_url:`${process.env.NEXT_PUBLIC_BASE_URL||"http://localhost:3000"}/booking-success`});if("succeeded"===a.status||"processing"===a.status)return{success:!0,message:"Payment processed successfully",transactionId:a.id};return{success:!1,message:`Payment failed with status: ${a.status}`}}catch(t){return console.error("Stripe payment error:",t),{success:!1,message:t.message||"Payment processing failed"}}}let m=new a.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/book-trip/route",pathname:"/api/book-trip",filename:"route",bundlePath:"app/api/book-trip/route"},resolvedPagePath:"/Users/surajrawat/Downloads/Tripy/app/api/book-trip/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:f,workUnitAsyncStorage:b,serverHooks:M}=m;function k(){return(0,s.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:b})}},6487:()=>{},8335:()=>{},5173:(t,e,r)=>{"use strict";async function o(t){if(!process.env.RAPIDAPI_KEY)throw Error("Bus API credentials are not configured.");try{return function(t,e,r,o){let a=[],n=["RedBus Express","AbhiBus Travels","eTravelSmart","Travelyaari","TicketGoose","KSRTC","MSRTC","GSRTC","TNSTC","UPSRTC"],s=["Volvo A/C Sleeper","Mercedes Multi-Axle","Volvo A/C Seater","Non A/C Sleeper","Non A/C Seater","Deluxe","Super Deluxe","Ultra Deluxe","Semi Sleeper"],i=["WiFi","Charging Point","Water Bottle","Blanket","Reading Light","Snacks","TV","Emergency Exit","CCTV"],u=5+Math.floor(6*Math.random());for(let o=0;o<u;o++){let u=6+Math.floor(18*Math.random()),l=Math.floor(60*Math.random()),p=`${u.toString().padStart(2,"0")}:${l.toString().padStart(2,"0")}`,d=3+Math.floor(10*Math.random()),c=Math.floor(60*Math.random()),h=(u+d)%24,g=(l+c)%60,m=`${h.toString().padStart(2,"0")}:${g.toString().padStart(2,"0")}`,f=500+Math.floor(2e3*Math.random()),b=n[Math.floor(Math.random()*n.length)],M=s[Math.floor(Math.random()*s.length)],k=2+Math.floor(4*Math.random()),w=[];for(let t=0;t<k;t++){let t=i[Math.floor(Math.random()*i.length)];w.includes(t)||w.push(t)}let y=5+Math.floor(36*Math.random()),T=(3+2*Math.random()).toFixed(1);a.push({id:`BUS-${Date.now()}-${o}`,operator:b,busType:M,departureTime:p,arrivalTime:m,duration:`${d}h ${c}m`,price:f,currency:"INR",departureCity:t,arrivalCity:e,departureDate:r,availableSeats:y,amenities:w,rating:parseFloat(T),deeplink:`https://example.com/book-bus/${b.toLowerCase().replace(/\s+/g,"-")}/${r}/${t.toLowerCase()}-${e.toLowerCase()}`})}return a.sort((t,e)=>t.price-e.price)}(t.origin,t.destination,t.departureDate,t.passengers)}catch(t){throw console.error("Bus API Error:",t),Error(`Failed to fetch bus data: ${t.message}`)}}async function a(t,e,r,o=!1){let n="string"==typeof t?t:t.id;if(await new Promise(t=>setTimeout(t,1500+1e3*Math.random())),!(Math.random()>.1))throw Error(`${o?"Return bus":"Bus"} booking failed - no seats available`);return{type:"bus",isReturn:o,bookingId:`BUS-${o?"RET-":""}${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,pnr:`PNR${Math.random().toString(36).substring(2,8).toUpperCase()}`,status:"confirmed",busId:n,passengers:r,totalAmount:"object"==typeof t?t.price*r:0}}r.d(e,{i:()=>a,searchBuses:()=>o})},9841:(t,e,r)=>{"use strict";async function o(t){if(!process.env.RAPIDAPI_KEY)throw Error("Train API credentials are not configured.");try{return function(t,e,r,o){let a=[`${e} Express`,`${t} - ${e} Shatabdi`,`${t} - ${e} Rajdhani`,`${t} - ${e} Duronto`,`${t} - ${e} Superfast`],n=["Superfast","Express","Passenger","Shatabdi","Rajdhani","Duronto"],s=["1A","2A","3A","SL","CC","EC"],i=new Date(r),u=Math.floor(3*Math.random())+3,l=[];for(let r=0;r<u;r++){let r=6+Math.floor(16*Math.random()),o=Math.floor(60*Math.random()),u=new Date(i);u.setHours(r,o,0,0);let p=3+Math.floor(9*Math.random()),d=Math.floor(60*Math.random()),c=new Date(u);c.setHours(c.getHours()+p,c.getMinutes()+d);let h=800+Math.floor(2200*Math.random()),g=`${1e4+Math.floor(9e4*Math.random())}`,m=a[Math.floor(Math.random()*a.length)],f=n[Math.floor(Math.random()*n.length)],b=s[Math.floor(Math.random()*s.length)],M=10+Math.floor(190*Math.random());l.push({id:`TRAIN-${g}`,trainNumber:g,trainName:m,trainType:f,departureTime:u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),arrivalTime:c.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),duration:`${p}h ${d}m`,price:h,currency:"INR",departureCity:t,arrivalCity:e,departureDate:i.toISOString().split("T")[0],availableSeats:M,trainClass:b,platform:`${1+Math.floor(10*Math.random())}`,deeplink:"https://www.irctc.co.in/nget/train-search"})}return l}(t.origin,t.destination,t.departureDate,t.passengers)}catch(t){throw console.error("Train API Error:",t),Error(`Failed to fetch train data: ${t.message}`)}}async function a(t,e,r,o=!1){let n="string"==typeof t?t:t.id;if(await new Promise(t=>setTimeout(t,1500+1e3*Math.random())),!(Math.random()>.1))throw Error(`${o?"Return train":"Train"} booking failed - no seats available`);return{type:"train",isReturn:o,bookingId:`TRAIN-${o?"RET-":""}${Date.now()}-${Math.random().toString(36).substring(2,8).toUpperCase()}`,pnr:`${Math.random().toString(36).substring(2,10).toUpperCase()}`,status:"confirmed",trainId:n,passengers:r,totalAmount:"object"==typeof t?t.price*r:0}}r.d(e,{O:()=>a,searchTrains:()=>o})}};var e=require("../../../webpack-runtime.js");e.C(t);var r=t=>e(e.s=t),o=e.X(0,[994,452],()=>r(6));module.exports=o})();