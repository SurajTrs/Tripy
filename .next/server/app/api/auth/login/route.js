(()=>{var e={};e.id=758,e.ids=[758],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},9021:e=>{"use strict";e.exports=require("fs")},3873:e=>{"use strict";e.exports=require("path")},6665:(e,o,r)=>{"use strict";r.r(o),r.d(o,{patchFetch:()=>A,routeModule:()=>u,serverHooks:()=>p,workAsyncStorage:()=>f,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>c});var t=r(2706),n=r(8203),a=r(5994),i=r(9187),l=r(4926),d=r(5900);async function c(e){try{console.log("Login API: Received login request");let{email:o,password:r}=await e.json();if(console.log("Login API: Email provided:",o),!o||!r)return console.log("Login API: Missing email or password"),i.NextResponse.json({message:"Email and password are required"},{status:400});console.log("Login API: Attempting login for email:",o);let s=await (0,d.CF)();console.log("Login API: All users:",s.map(e=>({id:e.id,email:e.email})));let t=await (0,d.Gs)(o);if(console.log("Login API: Found user for login attempt:",!!t),!t)return console.log("Login API: User not found with email:",o),i.NextResponse.json({message:"Invalid email or password"},{status:401});console.log("Login API: User found:",t.email,"ID:",t.id),console.log("Login API: Verifying password");let n=await l.Ay.compare(r,t.password);if(console.log("Login API: Password valid:",n),!n)return console.log("Login API: Invalid password"),i.NextResponse.json({message:"Invalid email or password"},{status:401});let a=await (0,d.jw)(t.id);console.log("Login API: Created session token:",a);let c=await (0,d.$z)(t);console.log("Login API: User data:",c);let u=i.NextResponse.json({message:"Login successful",user:c}),f={httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800,domain:void 0};return u.cookies.set("session_token",a,f),console.log("Login API: Set session cookie:",a),console.log("Login API: Cookie options:",f),u}catch(e){return console.error("Login error:",e),i.NextResponse.json({message:"Internal server error"},{status:500})}}let u=new t.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"/Users/surajrawat/Downloads/Tripy/app/api/auth/login/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:f,workUnitAsyncStorage:g,serverHooks:p}=u;function A(){return(0,a.patchFetch)({workAsyncStorage:f,workUnitAsyncStorage:g})}},9230:(e,o,r)=>{"use strict";r.r(o),r.d(o,{"00792d98f3de0b0c957a0a33adfef061e830089dbf":()=>s.lo,"403980207efafd47dd57b7cd7a111890c0a24d888a":()=>s.nu,"7f321eab5a8728ed7e2aa41e2e79841e2d4077828f":()=>s.kg,"7f5c198435244005e8a1d7eb570b47c29788ce402b":()=>s.CF,"7f89533fbea31e626534bde2c9d7debb65ec6055a8":()=>s.$z,"7f96abeee4aadd7e27e6369fe2f61622a74229e243":()=>s.KP,"7f9ef4683243e0001e5c6781624b3b842fe32c3ec3":()=>s.lC,"7fa9583635d4c73f10f989f35187a93d8005b6ebe8":()=>s.Gs,"7fb408d56da0789bfe3d8ac989887863d2ae31a4b0":()=>s.jw,"7fc3d7464473b732d22494ae2c2c0c384b8fdf0a19":()=>s.ME});var s=r(5900)},6487:()=>{},8335:()=>{},5900:(e,o,r)=>{"use strict";r.d(o,{$z:()=>h,CF:()=>x,Gs:()=>A,KP:()=>v,ME:()=>m,jw:()=>S,kg:()=>w,lC:()=>b,lo:()=>g,nu:()=>p});var s=r(8977);r(8063);var t=r(9021),n=r.n(t),a=r(3873),i=r.n(a),l=r(691),d=r(6215);let c=i().join(process.cwd(),"users.json"),u=[],f=()=>{console.log("Current sessions:",u.map(e=>({id:e.id,userId:e.userId})))};async function g(){try{let e=n().readFileSync(c,"utf-8");return JSON.parse(e)}catch(e){return console.error("Error reading users file:",e),[]}}async function p(e){let o=await g();o.push(e),n().writeFileSync(c,JSON.stringify(o,null,2))}async function A(e){return(await g()).find(o=>o.email===e)}async function b(e){return(await g()).find(o=>o.id===e)}async function w(e){let o={...e,id:`user_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,createdAt:new Date().toISOString()};return await p(o),o}async function S(e){let o=(0,l.A)(),r={id:o,userId:e,createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+6048e5).toISOString()};return u.push(r),console.log("Server AuthStore: Created new session:",{sessionId:o,userId:e}),console.log("Server AuthStore: Total sessions:",u.length),o}async function v(e){if(!e||"string"!=typeof e){console.log("Server AuthStore: Invalid session ID provided:",e);return}console.log("Server AuthStore: Finding session:",e),f();let o=new Date,r=u.filter(e=>new Date(e.expiresAt)<=o);r.length>0&&(console.log(`Server AuthStore: Removing ${r.length} expired sessions`),r.forEach(e=>{console.log("Server AuthStore: Removing expired session:",e.id)}));let s=(u=u.filter(e=>new Date(e.expiresAt)>o)).find(o=>o.id===e);if(console.log("Server AuthStore: Session found:",!!s),s){if(console.log("Server AuthStore: Session user ID:",s.userId),console.log("Server AuthStore: Session expires:",new Date(s.expiresAt).toISOString()),new Date(s.expiresAt)<=o){console.log("Server AuthStore: Session is expired, removing it"),u=u.filter(o=>o.id!==e);return}}else console.log("Server AuthStore: No matching session found for ID:",e);return s}async function m(e){u=u.filter(o=>o.id!==e)}async function h(e){let{password:o,...r}=e;return r}async function x(){return await g()}(0,d.D)([g,p,A,b,w,S,v,m,h,x]),(0,s.A)(g,"00792d98f3de0b0c957a0a33adfef061e830089dbf",null),(0,s.A)(p,"403980207efafd47dd57b7cd7a111890c0a24d888a",null),(0,s.A)(A,"7fa9583635d4c73f10f989f35187a93d8005b6ebe8",null),(0,s.A)(b,"7f9ef4683243e0001e5c6781624b3b842fe32c3ec3",null),(0,s.A)(w,"7f321eab5a8728ed7e2aa41e2e79841e2d4077828f",null),(0,s.A)(S,"7fb408d56da0789bfe3d8ac989887863d2ae31a4b0",null),(0,s.A)(v,"7f96abeee4aadd7e27e6369fe2f61622a74229e243",null),(0,s.A)(m,"7fc3d7464473b732d22494ae2c2c0c384b8fdf0a19",null),(0,s.A)(h,"7f89533fbea31e626534bde2c9d7debb65ec6055a8",null),(0,s.A)(x,"7f5c198435244005e8a1d7eb570b47c29788ce402b",null)}};var o=require("../../../../webpack-runtime.js");o.C(e);var r=e=>o(o.s=e),s=o.X(0,[994,452,732,792],()=>r(6665));module.exports=s})();