(()=>{var e={};e.id=24,e.ids=[24,854],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9646:e=>{"use strict";e.exports=require("child_process")},5511:e=>{"use strict";e.exports=require("crypto")},4735:e=>{"use strict";e.exports=require("events")},1630:e=>{"use strict";e.exports=require("http")},5591:e=>{"use strict";e.exports=require("https")},8354:e=>{"use strict";e.exports=require("util")},5536:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>w,routeModule:()=>m,serverHooks:()=>k,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>g});var s={};r.r(s),r.d(s,{POST:()=>d});var o=r(2706),n=r(8203),i=r(5994),a=r(9187),c=r(1854),u=r(4512);let p=process.env.STRIPE_WEBHOOK_SECRET;async function d(e){try{let t;let r=await e.text(),s=(0,u.b3)().get("stripe-signature");if(!s||!p||!c.stripe)return a.NextResponse.json({error:"Missing Stripe configuration"},{status:400});try{t=c.stripe.webhooks.constructEvent(r,s,p)}catch(e){return console.error(`Webhook signature verification failed: ${e.message}`),a.NextResponse.json({error:`Webhook signature verification failed: ${e.message}`},{status:400})}switch(t.type){case"payment_intent.succeeded":let o=t.data.object;console.log(`PaymentIntent for ${o.amount} was successful!`),await l(o.metadata?.tripId||"unknown","confirmed",o.id);break;case"payment_intent.payment_failed":let n=t.data.object;console.log(`Payment failed: ${n.last_payment_error?.message}`),await l(n.metadata?.tripId||"unknown","failed",n.id);break;case"checkout.session.completed":let i=t.data.object;console.log(`Checkout session completed: ${i.id}`),await l(i.metadata?.tripId||"unknown","confirmed",i.id);break;default:console.log(`Unhandled event type ${t.type}`)}return a.NextResponse.json({received:!0})}catch(e){return console.error("Stripe webhook error:",e),a.NextResponse.json({error:e.message},{status:500})}}async function l(e,t,r){console.log(`Updating booking ${e} to status: ${t} with payment ID: ${r}`)}let m=new o.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/webhooks/stripe/route",pathname:"/api/webhooks/stripe",filename:"route",bundlePath:"app/api/webhooks/stripe/route"},resolvedPagePath:"/Users/surajrawat/Downloads/Tripy/app/api/webhooks/stripe/route.ts",nextConfigOutput:"",userland:s}),{workAsyncStorage:h,workUnitAsyncStorage:g,serverHooks:k}=m;function w(){return(0,i.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:g})}},6487:()=>{},8335:()=>{},1854:(e,t,r)=>{"use strict";r.d(t,{fw:()=>i,stripe:()=>n}),r(9248);var s=r(9657);let o=process.env.STRIPE_SECRET_KEY;o||console.error("Missing STRIPE_SECRET_KEY environment variable");let n=o?new s.A(o,{apiVersion:"2023-10-16"}):null;async function i({lineItems:e,successUrl:t,cancelUrl:r,metadata:s={}}){if(!n)throw Error("Stripe is not initialized. Check your environment variables.");try{return await n.checkout.sessions.create({payment_method_types:["card"],line_items:e,mode:"payment",success_url:t,cancel_url:r,metadata:s})}catch(e){throw console.error("Error creating checkout session:",e),Error(`Failed to create checkout session: ${e.message}`)}}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[994,452,512,184],()=>r(5536));module.exports=s})();