(()=>{var r={};r.id=68,r.ids=[68,854],r.modules={846:r=>{"use strict";r.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:r=>{"use strict";r.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:r=>{"use strict";r.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:r=>{"use strict";r.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:r=>{"use strict";r.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},9646:r=>{"use strict";r.exports=require("child_process")},5511:r=>{"use strict";r.exports=require("crypto")},4735:r=>{"use strict";r.exports=require("events")},1630:r=>{"use strict";r.exports=require("http")},5591:r=>{"use strict";r.exports=require("https")},8354:r=>{"use strict";r.exports=require("util")},8895:(r,e,t)=>{"use strict";t.r(e),t.d(e,{patchFetch:()=>h,routeModule:()=>c,serverHooks:()=>m,workAsyncStorage:()=>d,workUnitAsyncStorage:()=>l});var a={};t.r(a),t.d(a,{POST:()=>p});var o=t(2706),s=t(8203),n=t(5994),i=t(9187),u=t(1854);async function p(r){try{let{tripPlan:e,userDetails:t}=await r.json();if(!e)return i.NextResponse.json({success:!1,message:"Missing trip plan information"},{status:400});e.total||(e.transport?.price,e.hotel?.price,e.cabToStation?.price,e.cabToHotel?.price,e.returnTransport?.price,e.groupSize);let a=[];e.transport&&a.push({price_data:{currency:"inr",product_data:{name:`${e.transportType?.toUpperCase()||"Transport"} from ${e.transport.departureCity||""} to ${e.transport.arrivalCity||""}`,description:`${e.transport.departureTime||""} - ${e.transport.arrivalTime||""} | ${e.transport.duration||""}`},unit_amount:Math.round(100*e.transport.price)},quantity:e.groupSize||1}),e.returnTrip&&e.returnTransport&&a.push({price_data:{currency:"inr",product_data:{name:`Return ${e.transportType?.toUpperCase()||"Transport"} from ${e.returnTransport.departureCity||""} to ${e.returnTransport.arrivalCity||""}`,description:`${e.returnTransport.departureTime||""} - ${e.returnTransport.arrivalTime||""} | ${e.returnTransport.duration||""}`},unit_amount:Math.round(100*e.returnTransport.price)},quantity:e.groupSize||1}),e.hotel&&a.push({price_data:{currency:"inr",product_data:{name:`Hotel: ${e.hotel.name||"Accommodation"}`,description:`${e.hotel.location||""} | ${e.hotel.rating||""} Star`},unit_amount:Math.round(100*e.hotel.price)},quantity:e.groupSize||1}),e.cabToStation&&a.push({price_data:{currency:"inr",product_data:{name:e.cabToStation.name||"Cab to Station",description:e.cabToStation.details||""},unit_amount:Math.round(100*e.cabToStation.price)},quantity:1}),e.cabToHotel&&a.push({price_data:{currency:"inr",product_data:{name:e.cabToHotel.name||"Cab to Hotel",description:e.cabToHotel.details||""},unit_amount:Math.round(100*e.cabToHotel.price)},quantity:1});let o={tripId:`TRIP-${Date.now()}`,transportType:e.transportType||"",origin:e.transport?.departureCity||"",destination:e.transport?.arrivalCity||"",departureDate:e.transport?.departureDate||"",returnDate:e.returnDate||"",groupSize:String(e.groupSize||1),userName:t?.name||"Guest User",userEmail:t?.email||"guest@example.com"},s=await (0,u.fw)({lineItems:a,successUrl:`${r.headers.get("origin")}/booking-success?session_id={CHECKOUT_SESSION_ID}`,cancelUrl:`${r.headers.get("origin")}/booking-cancelled`,metadata:o});return i.NextResponse.json({success:!0,sessionId:s.id,checkoutUrl:s.url})}catch(r){return console.error("Stripe checkout error:",r),i.NextResponse.json({success:!1,message:r.message||"An error occurred during checkout"},{status:500})}}let c=new o.AppRouteRouteModule({definition:{kind:s.RouteKind.APP_ROUTE,page:"/api/stripe/checkout/route",pathname:"/api/stripe/checkout",filename:"route",bundlePath:"app/api/stripe/checkout/route"},resolvedPagePath:"/Users/surajrawat/Downloads/Tripy/app/api/stripe/checkout/route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:d,workUnitAsyncStorage:l,serverHooks:m}=c;function h(){return(0,n.patchFetch)({workAsyncStorage:d,workUnitAsyncStorage:l})}},6487:()=>{},8335:()=>{},1854:(r,e,t)=>{"use strict";t.d(e,{fw:()=>n,stripe:()=>s}),t(9248);var a=t(9657);let o=process.env.STRIPE_SECRET_KEY;o||console.error("Missing STRIPE_SECRET_KEY environment variable");let s=o?new a.A(o,{apiVersion:"2023-10-16"}):null;async function n({lineItems:r,successUrl:e,cancelUrl:t,metadata:a={}}){if(!s)throw Error("Stripe is not initialized. Check your environment variables.");try{return await s.checkout.sessions.create({payment_method_types:["card"],line_items:r,mode:"payment",success_url:e,cancel_url:t,metadata:a})}catch(r){throw console.error("Error creating checkout session:",r),Error(`Failed to create checkout session: ${r.message}`)}}}};var e=require("../../../../webpack-runtime.js");e.C(r);var t=r=>e(e.s=r),a=e.X(0,[994,452,184],()=>t(8895));module.exports=a})();