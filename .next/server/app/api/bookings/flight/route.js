(()=>{var e={};e.id=87,e.ids=[87],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5511:e=>{"use strict";e.exports=require("crypto")},9021:e=>{"use strict";e.exports=require("fs")},3873:e=>{"use strict";e.exports=require("path")},9291:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>v,routeModule:()=>A,serverHooks:()=>b,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>m});var n={};r.r(n),r.d(n,{POST:()=>S});var s=r(2706),a=r(8203),o=r(5994),i=r(9187),c=r(4512),u=r(5900);let l=process.env.AMADEUS_BASE_URL||"https://test.api.amadeus.com",d=process.env.AMADEUS_CLIENT_ID,f=process.env.AMADEUS_CLIENT_SECRET;async function g(){if(!d||!f)throw Error("Amadeus credentials missing: set AMADEUS_CLIENT_ID and AMADEUS_CLIENT_SECRET");let e=new URLSearchParams;e.set("grant_type","client_credentials"),e.set("client_id",d),e.set("client_secret",f);let t=await fetch(`${l}/v1/security/oauth2/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e,cache:"no-store"});if(!t.ok){let e=await t.text();throw Error(`Amadeus auth failed: ${t.status} ${e}`)}return(await t.json()).access_token}async function p(e){let t=await g(),r=new URLSearchParams({originLocationCode:e.originLocationCode,destinationLocationCode:e.destinationLocationCode,departureDate:e.departureDate,adults:String(e.adults)});e.returnDate&&r.set("returnDate",e.returnDate),e.travelClass&&r.set("travelClass",e.travelClass),e.currencyCode&&r.set("currencyCode",e.currencyCode),e.max&&r.set("max",String(e.max));let n=await fetch(`${l}/v2/shopping/flight-offers?${r.toString()}`,{headers:{Authorization:`Bearer ${t}`},cache:"no-store"});if(!n.ok){let e=await n.text();throw Error(`Amadeus search failed: ${n.status} ${e}`)}return{token:t,data:await n.json()}}async function h(e,t){let r=t||await g(),n=JSON.stringify({data:{type:"flight-offers-pricing",flightOffers:[e]}}),s=await fetch(`${l}/v1/shopping/flight-offers/pricing`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:n,cache:"no-store"});if(!s.ok){let e=await s.text();throw Error(`Amadeus pricing failed: ${s.status} ${e}`)}let a=await s.json(),o=a?.data?.flightOffers?.[0]||a?.data;return{token:r,data:a,pricedOffer:o}}async function y(e,t){let r=t||await g(),n={data:{type:"flight-order",flightOffers:[e.flightOffer],travelers:e.passengers.map(e=>({id:e.id,dateOfBirth:e.dateOfBirth,gender:e.gender||"UNSPECIFIED",name:{firstName:e.name.firstName,lastName:e.name.lastName},contact:e.contact,documents:e.documents})),contacts:e.contacts}},s=await fetch(`${l}/v1/booking/flight-orders`,{method:"POST",headers:{Authorization:`Bearer ${r}`,"Content-Type":"application/json"},body:JSON.stringify(n),cache:"no-store"});if(!s.ok){let e=await s.text();throw Error(`Amadeus order failed: ${s.status} ${e}`)}let a=await s.json(),o=a?.data||a;return{id:o?.id,type:o?.type,associatedRecords:o?.associatedRecords,travelers:o?.travelers,tickets:o?.tickets,raw:a}}async function S(e){try{let t;let r=await (0,c.UL)(),n=r.get("session_token")?.value;if(!n)return i.NextResponse.json({success:!1,message:"Not authenticated"},{status:401});if(!await (0,u.KP)(n))return i.NextResponse.json({success:!1,message:"Invalid session"},{status:401});let s=await e.json();if(!process.env.AMADEUS_CLIENT_ID||!process.env.AMADEUS_CLIENT_SECRET)return i.NextResponse.json({success:!1,message:"Missing Amadeus credentials. Set AMADEUS_CLIENT_ID and AMADEUS_CLIENT_SECRET."},{status:500});let a=s.flightOffer;if(!a){let e=s.search;if(!e||!e.originLocationCode||!e.destinationLocationCode||!e.departureDate||!e.adults)return i.NextResponse.json({success:!1,message:"Invalid search parameters"},{status:400});let r=await p(e);t=r.token;let n=r.data?.data||[];if(!n.length)return i.NextResponse.json({success:!1,message:"No flight offers found"},{status:404});a=n[0]}let o=await h(a,t);t=o.token;let l=o.pricedOffer||a,d=s.passengers;if(!Array.isArray(d)||0===d.length)return i.NextResponse.json({success:!1,message:"Passengers are required"},{status:400});let f=await y({flightOffer:l,passengers:d,contacts:s.contacts},t),g=f?.associatedRecords?.[0]?.reference;return i.NextResponse.json({success:!0,orderId:f.id,pnr:g,order:f})}catch(e){return console.error("Flight booking error:",e),i.NextResponse.json({success:!1,message:e?.message||"Internal server error"},{status:500})}}let A=new s.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/bookings/flight/route",pathname:"/api/bookings/flight",filename:"route",bundlePath:"app/api/bookings/flight/route"},resolvedPagePath:"/Users/surajrawat/Downloads/Tripy/app/api/bookings/flight/route.ts",nextConfigOutput:"",userland:n}),{workAsyncStorage:w,workUnitAsyncStorage:m,serverHooks:b}=A;function v(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:m})}},9230:(e,t,r)=>{"use strict";r.r(t),r.d(t,{"00792d98f3de0b0c957a0a33adfef061e830089dbf":()=>n.lo,"403980207efafd47dd57b7cd7a111890c0a24d888a":()=>n.nu,"7f321eab5a8728ed7e2aa41e2e79841e2d4077828f":()=>n.kg,"7f5c198435244005e8a1d7eb570b47c29788ce402b":()=>n.CF,"7f89533fbea31e626534bde2c9d7debb65ec6055a8":()=>n.$z,"7f96abeee4aadd7e27e6369fe2f61622a74229e243":()=>n.KP,"7f9ef4683243e0001e5c6781624b3b842fe32c3ec3":()=>n.lC,"7fa9583635d4c73f10f989f35187a93d8005b6ebe8":()=>n.Gs,"7fb408d56da0789bfe3d8ac989887863d2ae31a4b0":()=>n.jw,"7fc3d7464473b732d22494ae2c2c0c384b8fdf0a19":()=>n.ME});var n=r(5900)},6487:()=>{},8335:()=>{},5900:(e,t,r)=>{"use strict";r.d(t,{$z:()=>b,CF:()=>v,Gs:()=>h,KP:()=>w,ME:()=>m,jw:()=>A,kg:()=>S,lC:()=>y,lo:()=>g,nu:()=>p});var n=r(8977);r(8063);var s=r(9021),a=r.n(s),o=r(3873),i=r.n(o),c=r(691),u=r(6215);let l=i().join(process.cwd(),"users.json"),d=[],f=()=>{console.log("Current sessions:",d.map(e=>({id:e.id,userId:e.userId})))};async function g(){try{let e=a().readFileSync(l,"utf-8");return JSON.parse(e)}catch(e){return console.error("Error reading users file:",e),[]}}async function p(e){let t=await g();t.push(e),a().writeFileSync(l,JSON.stringify(t,null,2))}async function h(e){return(await g()).find(t=>t.email===e)}async function y(e){return(await g()).find(t=>t.id===e)}async function S(e){let t={...e,id:`user_${Date.now()}_${Math.random().toString(36).substring(2,8)}`,createdAt:new Date().toISOString()};return await p(t),t}async function A(e){let t=(0,c.A)(),r={id:t,userId:e,createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+6048e5).toISOString()};return d.push(r),console.log("Server AuthStore: Created new session:",{sessionId:t,userId:e}),console.log("Server AuthStore: Total sessions:",d.length),t}async function w(e){if(!e||"string"!=typeof e){console.log("Server AuthStore: Invalid session ID provided:",e);return}console.log("Server AuthStore: Finding session:",e),f();let t=new Date,r=d.filter(e=>new Date(e.expiresAt)<=t);r.length>0&&(console.log(`Server AuthStore: Removing ${r.length} expired sessions`),r.forEach(e=>{console.log("Server AuthStore: Removing expired session:",e.id)}));let n=(d=d.filter(e=>new Date(e.expiresAt)>t)).find(t=>t.id===e);if(console.log("Server AuthStore: Session found:",!!n),n){if(console.log("Server AuthStore: Session user ID:",n.userId),console.log("Server AuthStore: Session expires:",new Date(n.expiresAt).toISOString()),new Date(n.expiresAt)<=t){console.log("Server AuthStore: Session is expired, removing it"),d=d.filter(t=>t.id!==e);return}}else console.log("Server AuthStore: No matching session found for ID:",e);return n}async function m(e){d=d.filter(t=>t.id!==e)}async function b(e){let{password:t,...r}=e;return r}async function v(){return await g()}(0,u.D)([g,p,h,y,S,A,w,m,b,v]),(0,n.A)(g,"00792d98f3de0b0c957a0a33adfef061e830089dbf",null),(0,n.A)(p,"403980207efafd47dd57b7cd7a111890c0a24d888a",null),(0,n.A)(h,"7fa9583635d4c73f10f989f35187a93d8005b6ebe8",null),(0,n.A)(y,"7f9ef4683243e0001e5c6781624b3b842fe32c3ec3",null),(0,n.A)(S,"7f321eab5a8728ed7e2aa41e2e79841e2d4077828f",null),(0,n.A)(A,"7fb408d56da0789bfe3d8ac989887863d2ae31a4b0",null),(0,n.A)(w,"7f96abeee4aadd7e27e6369fe2f61622a74229e243",null),(0,n.A)(m,"7fc3d7464473b732d22494ae2c2c0c384b8fdf0a19",null),(0,n.A)(b,"7f89533fbea31e626534bde2c9d7debb65ec6055a8",null),(0,n.A)(v,"7f5c198435244005e8a1d7eb570b47c29788ce402b",null)},6215:(e,t)=>{"use strict";function r(e){for(let t=0;t<e.length;t++){let r=e[t];if("function"!=typeof r)throw Error(`A "use server" file can only export async functions, found ${typeof r}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`)}}Object.defineProperty(t,"D",{enumerable:!0,get:function(){return r}})},8977:(e,t,r)=>{"use strict";Object.defineProperty(t,"A",{enumerable:!0,get:function(){return n.registerServerReference}});let n=r(6760)},4175:(e,t,r)=>{"use strict";let n;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{arrayBufferToString:function(){return i},decrypt:function(){return l},encrypt:function(){return u},getActionEncryptionKey:function(){return h},getClientReferenceManifestForRsc:function(){return p},getServerModuleMap:function(){return g},setReferenceManifestsSingleton:function(){return f},stringToUint8Array:function(){return c}});let s=r(9212),a=r(2045),o=r(9294);function i(e){let t=new Uint8Array(e),r=t.byteLength;if(r<65535)return String.fromCharCode.apply(null,t);let n="";for(let e=0;e<r;e++)n+=String.fromCharCode(t[e]);return n}function c(e){let t=e.length,r=new Uint8Array(t);for(let n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}function u(e,t,r){return crypto.subtle.encrypt({name:"AES-GCM",iv:t},e,r)}function l(e,t,r){return crypto.subtle.decrypt({name:"AES-GCM",iv:t},e,r)}let d=Symbol.for("next.server.action-manifests");function f({page:e,clientReferenceManifest:t,serverActionsManifest:r,serverModuleMap:n}){var s;let o=null==(s=globalThis[d])?void 0:s.clientReferenceManifestsPerPage;globalThis[d]={clientReferenceManifestsPerPage:{...o,[(0,a.normalizeAppPath)(e)]:t},serverActionsManifest:r,serverModuleMap:n}}function g(){let e=globalThis[d];if(!e)throw new s.InvariantError("Missing manifest for Server Actions.");return e.serverModuleMap}function p(){let e=globalThis[d];if(!e)throw new s.InvariantError("Missing manifest for Server Actions.");let{clientReferenceManifestsPerPage:t}=e,r=o.workAsyncStorage.getStore();if(!r)return function(e){let t=Object.values(e),r={clientModules:{},edgeRscModuleMapping:{},rscModuleMapping:{}};for(let e of t)r.clientModules={...r.clientModules,...e.clientModules},r.edgeRscModuleMapping={...r.edgeRscModuleMapping,...e.edgeRscModuleMapping},r.rscModuleMapping={...r.rscModuleMapping,...e.rscModuleMapping};return r}(t);let n=t[r.route];if(!n)throw new s.InvariantError(`Missing Client Reference Manifest for ${r.route}.`);return n}async function h(){if(n)return n;let e=globalThis[d];if(!e)throw new s.InvariantError("Missing manifest for Server Actions.");let t=process.env.NEXT_SERVER_ACTIONS_ENCRYPTION_KEY||e.serverActionsManifest.encryptionKey;if(void 0===t)throw new s.InvariantError("Missing encryption key for Server Actions");return n=await crypto.subtle.importKey("raw",c(atob(t)),"AES-GCM",!0,["encrypt","decrypt"])}},8063:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{decryptActionBoundArgs:function(){return g},encryptActionBoundArgs:function(){return f}}),r(7315);let n=r(6760),s=r(8534),a=r(7212),o=r(4175),i=r(3033),c=new TextEncoder,u=new TextDecoder;async function l(e,t){let r=await (0,o.getActionEncryptionKey)();if(void 0===r)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let n=atob(t),s=n.slice(0,16),a=n.slice(16),i=u.decode(await (0,o.decrypt)(r,(0,o.stringToUint8Array)(s),(0,o.stringToUint8Array)(a)));if(!i.startsWith(e))throw Error("Invalid Server Action payload: failed to decrypt.");return i.slice(e.length)}async function d(e,t){let r=await (0,o.getActionEncryptionKey)();if(void 0===r)throw Error("Missing encryption key for Server Action. This is a bug in Next.js");let n=new Uint8Array(16);i.workUnitAsyncStorage.exit(()=>crypto.getRandomValues(n));let s=(0,o.arrayBufferToString)(n.buffer),a=await (0,o.encrypt)(r,n,c.encode(e+t));return btoa(s+(0,o.arrayBufferToString)(a))}async function f(e,t){let{clientModules:r}=(0,o.getClientReferenceManifestForRsc)(),s=Error();Error.captureStackTrace(s,f);let c=!1,u=await (0,a.streamToString)((0,n.renderToReadableStream)(t,r,{onError(e){c||(c=!0,s.message=e instanceof Error?e.message:String(e))}}));if(c)throw s;let l=i.workUnitAsyncStorage.getStore();if(!l)return d(e,u);let g=(0,i.getPrerenderResumeDataCache)(l),p=(0,i.getRenderResumeDataCache)(l),h=e+u,y=(null==g?void 0:g.encryptedBoundArgs.get(h))??(null==p?void 0:p.encryptedBoundArgs.get(h));if(y)return y;let S="prerender"===l.type?l.cacheSignal:void 0;null==S||S.beginRead();let A=await d(e,u);return null==S||S.endRead(),null==g||g.encryptedBoundArgs.set(h,A),A}async function g(e,t){let{edgeRscModuleMapping:r,rscModuleMapping:n}=(0,o.getClientReferenceManifestForRsc)(),a=await l(e,await t);return await (0,s.createFromReadableStream)(new ReadableStream({start(e){e.enqueue(c.encode(a)),e.close()}}),{serverConsumerManifest:{moduleLoading:null,moduleMap:n,serverModuleMap:(0,o.getServerModuleMap)()}})}},164:(e,t)=>{"use strict";function r(e){return e.startsWith("/")?e:"/"+e}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureLeadingSlash",{enumerable:!0,get:function(){return r}})},2045:(e,t,r)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var r in t)Object.defineProperty(e,r,{enumerable:!0,get:t[r]})}(t,{normalizeAppPath:function(){return a},normalizeRscURL:function(){return o}});let n=r(164),s=r(8758);function a(e){return(0,n.ensureLeadingSlash)(e.split("/").reduce((e,t,r,n)=>!t||(0,s.isGroupSegment)(t)||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:e+"/"+t,""))}function o(e){return e.replace(/\.rsc($|\?)/,"$1")}},691:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var n=r(5511);let s={randomUUID:n.randomUUID},a=new Uint8Array(256),o=a.length,i=[];for(let e=0;e<256;++e)i.push((e+256).toString(16).slice(1));let c=function(e,t,r){if(s.randomUUID&&!t&&!e)return s.randomUUID();let c=(e=e||{}).random??e.rng?.()??(o>a.length-16&&((0,n.randomFillSync)(a),o=0),a.slice(o,o+=16));if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,t){if((r=r||0)<0||r+16>t.length)throw RangeError(`UUID byte range ${r}:${r+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[r+e]=c[e];return t}return function(e,t=0){return(i[e[t+0]]+i[e[t+1]]+i[e[t+2]]+i[e[t+3]]+"-"+i[e[t+4]]+i[e[t+5]]+"-"+i[e[t+6]]+i[e[t+7]]+"-"+i[e[t+8]]+i[e[t+9]]+"-"+i[e[t+10]]+i[e[t+11]]+i[e[t+12]]+i[e[t+13]]+i[e[t+14]]+i[e[t+15]]).toLowerCase()}(c)}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[994,452,732,512],()=>r(9291));module.exports=n})();